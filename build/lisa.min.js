'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},RegexCatchers={'*':function _(){return'(.*?)'},number:function number(){return'(\\d+[.]?|\\d*\\.\\d+)'},integer:function integer(){return'(\\d+)'},short_time:function short_time(){return'((?:[01]?\\d|2[0-3])(?: *: *| +'+Lisa.thinksTo('HOURS_NAME')+' +)[0-5]\\d(?:| +'+Lisa.thinksTo('MINUTES_NAME')+'))'},time:function time(){return'((?:[01]?\\d|2[0-3])(?: *: *| +'+Lisa.thinksTo('HOURS_NAME')+' +)[0-5]\\d(?: *: *| +'+Lisa.thinksTo('MINUTES_NAME')+' +)[0-5]\\d))(?:|'+Lisa.thinksTo('SECONDS_NAME')+')'},short_date:function short_date(){return'((?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *[\\/\\-\\.] *| +(?:'+Lisa.thinksTo('MONTHS').split(',').join('|')+'))'},date:function date(){return'((?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *[\\/\\-\\.] *| +(?:'+Lisa.thinksTo('MONTHS').split(',').join('|')+') +)\\d{4})'}},Lisa=new function(){var c=this,d=document.createElement('div'),f=[],g=[],h=!0,j={},k=[],l=[],m={message:null,did:null,learnt:null,forgot:null,understood:null};function a(o){var p=1<arguments.length&&arguments[1]!==void 0?arguments[1]:2;return'0'.repeat(p-o.length)+o}this.escapeHtml=function(o){return o.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;')},this.getStandard=function(o,p){if(!RegexCatchers.hasOwnProperty(p)&&'?'!==p)throw new Error('[Lisa] Unknown catcher "'+p+'"');if(['*','?','number','integer'].includes(p))return o;var q;switch(p){case'short_time':return o.replace(/^([0-9]+).*([0-9]+)$/,function(v,w,x){return a(w)+':'+a(x)});case'time':return o.replace(/^([0-9]+).*([0-9]+).*([0-9]+)$/,a($1)+':'+a($2)+':'+a($3));case'short_date':q=Lisa.thinksTo('MONTHS').split(',');for(var s,r=function _loop(v){if(o.includes(q))return{v:o.replace(/\d+/,function(w){return a(w)+'/'+a(v.toString())})}},v=0;v<q.length;v++)if(s=r(v),'object'===('undefined'==typeof s?'undefined':_typeof(s)))return s.v;return o.replace(/(\d+).*?(\d+)/,function(v,w,x){return a(w)+'/'+a(x)});case'date':q=Lisa.thinksTo('MONTHS').split(',');for(var u,t=function _loop2(v){if(o.includes(q[v]))return{v:o.replace(/(\d+).*?(\d+)/,function(w,x,y){return a(x)+'/'+a((v+1).toString())+'/'+a(y,4)})}},v=0;v<q.length;v++)if(u=t(v),'object'===('undefined'==typeof u?'undefined':_typeof(u)))return u.v;return o.replace(/(\d+).*?(\d+).*?(\d+)/,function(v,w,x,y){return a(w)+'/'+a(x)+'/'+a(y,4)});default:throw new Error('[Lisa] [BUG] Unreferenced catcher "'+p+'"');}},this.format=function(o){return c.escapeHtml(o).replace(/\*(.*?)\*/g,'<strong>$1</strong>').replace(/_(.*?)_/g,'<em>$1</em>').replace(/~(.*?)~/g,'<del>$1</del>').replace(/%([a-zA-Z][a-zA-Z0-9_]*)%/g,function(p,q){if(Lisa.knows(q))return Lisa.thinksTo(q);throw new Error('[Lisa] Variable "'+q+'" is not defined in message "'+o+'"')})},this.makeHandlerRegex=function(o){var p=1<arguments.length&&arguments[1]!==void 0&&arguments[1],q=[],r=new RegExp('^'+o.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,'\\$&').replace(/ /g,' +').replace(/\\\{(.*?)\\\}/g,function(s,t){if(t.startsWith('\\?'))return q.push('?'),t.substr(2).includes('\\|')?':'===t.substr(2,1)?'('+t.substr(3).split('\\|').join('|')+'|)':'('+t.substr(2).split('\\|').join('|')+')':'('+t.substr(2)+'|)';if('\\*'===t&&(t='*'),!RegexCatchers.hasOwnProperty(t))throw new Error('[Lisa] Unknown catcher "'+t+'"');return q.push(t),RegexCatchers[t]()}).replace(/( \+)?\\\.$/,' *(?:[\\.]*)?').replace(/( \+)?\\\?$/,' *(?:[\\?]*)?')+'(?: *[!\\.])*$','i');return p?[r,q]:r},this.when=function(o,p){if(!m.hasOwnProperty(o))throw new Error('[Lisa] Unknown event name');if('function'!=typeof p)throw new Error('[Lisa] Illegal callback provided, must be a function');m[o]=p},this.understands=function(o,p){var q=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3];if(k.includes(o))throw new Error('[Lisa] Handler is already in use');if('string'==typeof p)p=new Function([],Reflect.ownKeys(q).map(function(y){return'Lisa.remembers("'+y+'","'+q[y].replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function(z,A){return'"+arguments[0].formatted['+A+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function(z,A){return'"+arguments[0].caught['+A+']+"'})+'");'})+'return "'+p.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function(y,z){return'"+arguments[0].formatted['+z+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function(y,z){return'"+arguments[0].caught['+z+']+"'})+'"');else if('function'==typeof p)q&&function(){var y=p;p=function callback(A){var B=!0,C=!1,D=void 0;try{for(var F,G,E=Reflect.ownKeys(q)[Symbol.iterator]();!(B=(F=E.next()).done);B=!0)G=F.value,Lisa.remembers(G,q[G].replace(/\$\^(\d|[1-9]\d+)/g,function(H,I){return A.formatted[I]}).replace(/\$_(\d|[1-9]\d+)/g,function(H,I){return A.caught[I]}))}catch(G){C=!0,D=G}finally{try{!B&&E.return&&E.return()}finally{if(C)throw D}}return y.call(c,A)}}();else throw new Error('[Lisa] Illegal handler\'s callback provided');var s=c.makeHandlerRegex(o,!0);if(r){if(!Array.isArray(r))throw new Error('[Lisa] Illegal help text argument provided');if(r.length!==s[1].length)throw new Error('[Lisa] Insufficient help for parameters in handler "'+o+'"');var t=!0,u=!1,v=void 0;try{for(var x,y,w=r[Symbol.iterator]();!(t=(x=w.next()).done);t=!0)if(y=x.value,!['string','function'].includes('undefined'==typeof y?'undefined':_typeof(y)))throw new Error('[Lisa] Illegal help text given for handler "'+o+'"')}catch(y){u=!0,v=y}finally{try{!t&&w.return&&w.return()}finally{if(u)throw v}}}return l.push([s[0],s[1],p,r||null]),k.push(o),m.understood&&m.understood(new RegExp(s[0].toString().slice(1,-2)),s[1].slice(0),p,r?r.slice(0):null),s[0]},this.displayMessage=function(o,p,q){var r=document.createElement('div');r.setAttribute('class','message message-'+q),r.innerHTML='<strong>'+o+' : </strong>'+c.format(p),d.appendChild(r);var s=d.scrollHeight-d.scrollTop,t=setInterval(function(){return d.scrollTop++},Math.floor(2e3/s));setTimeout(function(){return clearInterval(t)},2e3),h&&f.push([Date.now(),o,p,q]),m.message&&m.message(Date.now(),o,p,q)},this.helpsAbout=function(o){var p=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(!k.includes(o))throw new Error('[Lisa] Unknown handler "'+o+'"');var q=l[k.indexOf(o)][3];if(!q)return!1;if(p)return q.slice(0);var r=0;return o.replace(/\{(.*?)\}/g,function(){return'['+q[r++]+']'})},this.learns=function(o,p){if('string'!=typeof o||!o.length||{}[o])throw new Error('[Lisa] Illegal name provided for memory\'s cell');if(!['string','number','boolean'].includes('undefined'==typeof p?'undefined':_typeof(p)))throw new Error('[Lisa] Illegal value provided for memory\'s cell "'+o+'"');j[o]=p,m.remembered&&m.remembered(o,p)},this.knows=function(o){return j.hasOwnProperty(o)},this.thinksTo=function(o){return j.hasOwnProperty(o)?j[o]:void 0},this.forgets=function(o){if(!j.hasOwnProperty(o))throw new Error('[Lisa] Can\'t forget unexisting cell doesn\'t exist');var p=j[o];return delete j[o],m.forgot&&m.forgot(o,p),p},this.says=function(o){return c.displayMessage('Lisa',o,'lisa')},this.hears=function(o){return c.displayMessage('You',o,'user')},this.does=function(o){var p=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,q=o;o=o.trim();var r,s=!0,t=!1,u=void 0;try{for(var w,x,v=l[Symbol.iterator]();!(s=(w=v.next()).done);s=!0)if(x=w.value,r=o.match(x[0])){for(var y={request:o,requestWithSpaces:q,caught:r.slice(1),formatted:[],handlerRegex:x[0],catchers:x[1],callback:x[2],help:x[3],handler:k[l.indexOf(x)],display:!!p},B=0;B<x[1].length;B++)y.formatted.push(c.getStandard(r[B+1],x[1][B]));var z=x[2].call(c,y),A=!1;return'number'==typeof z?z=A.toString():z&&z instanceof HTMLElement?(z=A.innerHTML,A=!0):'string'!=typeof z&&(z='Sorry, I encountered a problem. Please try again.'),p&&c.says(z,A),h&&g.push([Date.now(),y.requestWithSpaces,y.handler,y.caught.slice(0),y.display]),m.did&&m.did(g.slice(-1)[0],JSON.parse(JSON.stringify(y))),z}}catch(x){t=!0,u=x}finally{try{!s&&v.return&&v.return()}finally{if(t)throw u}}c.says('I didn\'t understand your request.',!0)},this.nowRemembersMessages=function(){h=!0},this.doesntRememberMessages=function(){h=!1},this.getMessage=function(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if('number'!=typeof o||Math.floor(o)!==o)throw new Error('[Lisa] Invalid ID given while getting message');if(0>o&&(o=-o),f.length<=o)throw new Error('[Lisa] There is no message with id "'+o+'"');return f.slice(0)},this.export=function(){var o=[],p=!0,q=!1,r=void 0;try{for(var t,u,s=l[Symbol.iterator]();!(p=(t=s.next()).done);p=!0)u=t.value,o.push([u[0].toString(),u[1],u[2].toString(),u[3]])}catch(u){q=!0,r=u}finally{try{!p&&s.return&&s.return()}finally{if(q)throw r}}return JSON.stringify({memory:j,handled:k,handlers:o,rememberMessages:h,messages:f,requests:g})},this.learns('HOURS_NAME','hours'),this.learns('MINUTES_NAME','minutes'),this.learns('SECONDS_NAME','secondes'),this.learns('MONTHS','january,february,march,april,may,june,july,august,september,october,november,december'),this.__defineGetter__('dom',function(){return d}),this.__defineGetter__('memory',function(){return JSON.parse(JSON.stringify(j))}),this.__defineGetter__('messages',function(){return JSON.parse(JSON.stringify(f))}),this.__defineGetter__('history',function(){return JSON.parse(JSON.stringify(g))}),this.__defineGetter__('remembersMessages',function(){return h}),this.__defineSetter__('remembersMessages',function(o){return o?c.nowRemembersMessages():c.doesntRememberMessages()})};Lisa.dom.setAttribute('id','discuss'),document.body.appendChild(Lisa.dom);var input=document.createElement('input');input.setAttribute('id','input'),input.addEventListener('keydown',function(a){if(13===a.keyCode){if(!input.value.length)return;var c=input.value;input.value='',Lisa.hears(c),Lisa.does(c)}}),document.body.appendChild(input);
