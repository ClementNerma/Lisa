'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&'function'==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?'symbol':typeof t},RegexCatchers={'*':function _(){return'(.*?)'},number:function number(){return'(\\d+[.]?|\\d*\\.\\d+)'},integer:function integer(){return'(\\d+)'},short_time:function short_time(){return'((?:[01]?\\d|2[0-3])(?: *: *| +'+Lisa.thinksTo('HOURS_NAME')+' +)[0-5]\\d(?:| +'+Lisa.thinksTo('MINUTES_NAME')+'))'},time:function time(){return'((?:[01]?\\d|2[0-3])(?: *: *| +'+Lisa.thinksTo('HOURS_NAME')+' +)[0-5]\\d(?: *: *| +'+Lisa.thinksTo('MINUTES_NAME')+' +)[0-5]\\d))(?:|'+Lisa.thinksTo('SECONDS_NAME')+')'},short_date:function short_date(){return'((?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *[\\/\\-\\.] *| +(?:'+Lisa.thinksTo('MONTHS').split(',').join('|')+'))'},date:function date(){return'((?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *[\\/\\-\\.] *| +(?:'+Lisa.thinksTo('MONTHS').split(',').join('|')+') +)\\d{4})'}},Lisa=new function(){var d=this,l=document.createElement('div'),u=[],p=[],h=!0,m={$:{}},g=[],y=[],L={message:null,did:null,learnt:null,forgot:null,understood:null};function t(_){var v=1<arguments.length&&arguments[1]!==void 0?arguments[1]:2;return'0'.repeat(v-_.length)+_}function r(_,v){return'boolean'===v?!1===_||!0===_:'integer'===v?!('number'!=typeof _||Math.floor(_)!==_||0>_):'floating'===v?'number'==typeof _:'string'===v?'string'==typeof _:void 0}this.escapeHtml=function(_){return _.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;')},this.getStandard=function(_,v){if(!RegexCatchers.hasOwnProperty(v)&&'?'!==v)throw new Error('[Lisa] Unknown catcher "'+v+'"');if(['*','?','number','integer'].includes(v))return _;var T;switch(v){case'short_time':return _.replace(/^([0-9]+).*([0-9]+)$/,function(k,O,I){return t(O)+':'+t(I)});case'time':return _.replace(/^([0-9]+).*([0-9]+).*([0-9]+)$/,t($1)+':'+t($2)+':'+t($3));case'short_date':T=Lisa.thinksTo('MONTHS').split(',');for(var S,x=function _loop(k){if(_.includes(T))return{v:_.replace(/\d+/,function(O){return t(O)+'/'+t(k.toString())})}},k=0;k<T.length;k++)if(S=x(k),'object'===('undefined'==typeof S?'undefined':_typeof(S)))return S.v;return _.replace(/(\d+).*?(\d+)/,function(k,O,I){return t(O)+'/'+t(I)});case'date':T=Lisa.thinksTo('MONTHS').split(',');for(var M,A=function _loop2(k){if(_.includes(T[k]))return{v:_.replace(/(\d+).*?(\d+)/,function(O,I,$){return t(I)+'/'+t((k+1).toString())+'/'+t($,4)})}},k=0;k<T.length;k++)if(M=A(k),'object'===('undefined'==typeof M?'undefined':_typeof(M)))return M.v;return _.replace(/(\d+).*?(\d+).*?(\d+)/,function(k,O,I,$){return t(O)+'/'+t(I)+'/'+t($,4)});default:throw new Error('[Lisa] [BUG] Unreferenced catcher "'+v+'"');}},this.format=function(_){return d.escapeHtml(_).replace(/\*(.*?)\*/g,'<strong>$1</strong>').replace(/_(.*?)_/g,'<em>$1</em>').replace(/~(.*?)~/g,'<del>$1</del>').replace(/%([a-zA-Z][a-zA-Z0-9_]*)%/g,function(v,T){if(Lisa.knows(T))return Lisa.thinksTo(T);throw new Error('[Lisa] Variable "'+T+'" is not defined in message "'+_+'"')})},this.makeHandlerRegex=function(_){var v=1<arguments.length&&arguments[1]!==void 0&&arguments[1],T=[],x=new RegExp('^'+_.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,'\\$&').replace(/ /g,' +').replace(/\\\{(.*?)\\\}/g,function(S,A){if(A.startsWith('\\?'))return T.push('?'),A.substr(2).includes('\\|')?':'===A.substr(2,1)?'('+A.substr(3).split('\\|').join('|')+'|)':'('+A.substr(2).split('\\|').join('|')+')':'('+A.substr(2)+'|)';if('\\*'===A&&(A='*'),!RegexCatchers.hasOwnProperty(A))throw new Error('[Lisa] Unknown catcher "'+A+'"');return T.push(A),RegexCatchers[A]()}).replace(/( \+)?\\\.$/,' *(?:[\\.]*)?').replace(/( \+)?\\\?$/,' *(?:[\\?]*)?')+'(?: *[!\\.])*$','i');return v?[x,T]:x},this.when=function(_,v){if(!L.hasOwnProperty(_))throw new Error('[Lisa] Unknown event name');if('function'!=typeof v)throw new Error('[Lisa] Illegal callback provided, must be a function');L[_]=v},this.understands=function(_,v){var T=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},x=arguments[3];if(g.includes(_))throw new Error('[Lisa] Handler is already in use');if('string'==typeof v)v=new Function([],Reflect.ownKeys(T).map(function($){return'Lisa.learns("'+$+'","'+T[$].replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function(P,j){return'"+arguments[0].formatted['+j+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function(P,j){return'"+arguments[0].caught['+j+']+"'})+'");'})+'return "'+v.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function($,P){return'"+arguments[0].formatted['+P+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function($,P){return'"+arguments[0].caught['+P+']+"'})+'"');else if('function'!=typeof v)throw new Error('[Lisa] Illegal handler\'s callback provided');else if(T){var $=v;v=new Function(['requested'],'('+function(P){var j=!0,U=!1,E=void 0;try{for(var N,H,C=Reflect.ownKeys(P)[Symbol.iterator]();!(j=(N=C.next()).done);j=!0)H=N.value,Lisa.learns(H,P[H].replace(/\$\^(\d|[1-9]\d+)/g,function(R,F){return requested.formatted[F]}).replace(/\$_(\d|[1-9]\d+)/g,function(R,F){return requested.caught[F]}))}catch(H){U=!0,E=H}finally{try{!j&&C.return&&C.return()}finally{if(U)throw E}}}.toString()+')('+JSON.stringify(T)+');return ('+$.toString()+')(requested);')}var S=d.makeHandlerRegex(_,!0);if(x){if(!Array.isArray(x))throw new Error('[Lisa] Illegal help text argument provided');if(x.length!==S[1].length)throw new Error('[Lisa] Insufficient help for parameters in handler "'+_+'"');var A=!0,M=!1,k=void 0;try{for(var I,$,O=x[Symbol.iterator]();!(A=(I=O.next()).done);A=!0)if($=I.value,!['string','function'].includes('undefined'==typeof $?'undefined':_typeof($)))throw new Error('[Lisa] Illegal help text given for handler "'+_+'"')}catch($){M=!0,k=$}finally{try{!A&&O.return&&O.return()}finally{if(M)throw k}}}return y.push([S[0],S[1],v,x||null]),g.push(_),L.understood&&L.understood(new RegExp(S[0].toString().slice(1,-2)),S[1].slice(0),v,x?x.slice(0):null),S[0]},this.displayMessage=function(_,v,T){var x=document.createElement('div');x.setAttribute('class','message message-'+T),x.innerHTML='<strong>'+_+' : </strong>'+d.format(v),l.appendChild(x);var S=l.scrollHeight-l.scrollTop,A=setInterval(function(){return l.scrollTop++},Math.floor(2e3/S));setTimeout(function(){return clearInterval(A)},2e3),h&&u.push([Date.now(),_,v,T]),L.message&&L.message(Date.now(),_,v,T)},this.helpsAbout=function(_){var v=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(!g.includes(_))throw new Error('[Lisa] Unknown handler "'+_+'"');var T=y[g.indexOf(_)][3];if(!T)return!1;if(v)return T.slice(0);var x=0;return _.replace(/\{(.*?)\}/g,function(){return'['+T[x++]+']'})},this.learns=function(_,v){if('string'!=typeof _||!_.length||{}[_]||'$'===_)throw new Error('[Lisa] Illegal name provided for memory\'s cell');if(!['string','number','boolean'].includes('undefined'==typeof v?'undefined':_typeof(v)))throw new Error('[Lisa] Illegal value provided for memory\'s cell "'+_+'"');m.$.hasOwnProperty(_)&&delete m.$[_],m[_]=v,L.learnt&&L.learnt(_,v)},this.learnsList=function(_,v,T){if('string'!=typeof _||!_.length||{}[_]||'$'===_)throw new Error('[Lisa] Illegal name provided for memory\'s cell');if(T={bool:'boolean',int:'integer',float:'floating',str:'string'}[T]||T,!['boolean','integer','floating','string'].includes(T))throw new Error('[Lisa] Unknown type "'+T+'", must be "boolean", "integer", "floating" or "string"');if(!Array.isArray(v))throw new Error('[Lisa] Illegal list provided, must be an array');v=v.slice(0);for(var x=0;x<v.length;x++)if(!r(v[x],T))throw new Error('[Lisa] Value at index '+x+' is not a '+T);m[_]=v,m.$[_]=T,L.learnt&&L.learnt(_,v.slice(0))},this.learnsBoolList=function(_,v){return d.learnsList(_,v,'boolean')},this.learnsIntList=function(_,v){return d.learnsList(_,v,'integer')},this.learnsFloatList=function(_,v){return d.learnsList(_,v,'floating')},this.learnsStrList=function(_,v){return d.learnsList(_,v,'string')},this.thinksToList=function(_){return m.$.hasOwnProperty(_)?m[_].slice(0):void 0},this.thinksToListValue=function(_,v){return m.$.hasOwnProperty(_)&&m[_].length>v?m[_][v]:void 0},this.thinksToListType=function(_){return m.$.hasOwnProperty(_)?m.$[_]:void 0},this.learnsListValue=function(_,v){if(!m.$.hasOwnProperty(_))throw new Error('[Lisa] Unknown list "'+_+'"');if(!r(v,m.$[_]))throw new Error('[Lisa] Provided value for list "'+_+'" is not an '+m.$[_]);m[_].push(v),L.learnt&&L.learnt(_,v,m[_].length-1)},this.knows=function(_){return'$'!==_&&m.hasOwnProperty(_)},this.knowsValue=function(_){return Object.values(m).includes(_)},this.knowsValueInList=function(_,v){return m.$.hasOwnProperty(_)&&m[_].includes(v)},this.searchesValue=function(_,v){var T=!0,x=!1,S=void 0;try{for(var M,k,A=Reflect.ownKeys(m)[Symbol.iterator]();!(T=(M=A.next()).done);T=!0){if(k=M.value,m[k]===_)return k;if(m.$[k]){if(!v)continue;if(m[k].includes(_))return k}}}catch(k){x=!0,S=k}finally{try{!T&&A.return&&A.return()}finally{if(x)throw S}}return!1},this.isList=function(_){return m.$.hasOwnProperty(_)},this.thinksTo=function(_){return m.hasOwnProperty(_)&&'$'!==_?Array.isArray(m[_])?m[_].join(';'):m[_]:void 0},this.forgets=function(_){if(!m.hasOwnProperty(_)||'$'===_)throw new Error('[Lisa] Can\'t forget unexisting cell');var v=m[_];return delete m[_],delete m.$[_],L.forgot&&L.forgot(_,v),v},this.thinksToListLength=function(_){return m.$.hasOwnProperty(_)?m[_].length:void 0},this.says=function(_){return d.displayMessage('Lisa',_,'lisa')},this.hears=function(_){return d.displayMessage('You',_,'user')},this.does=function(_){var v=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,T=_;_=_.trim();var x,S=!0,A=!1,M=void 0;try{for(var O,I,k=y[Symbol.iterator]();!(S=(O=k.next()).done);S=!0)if(I=O.value,x=_.match(I[0])){for(var $={request:_,requestWithSpaces:T,caught:x.slice(1),formatted:[],handlerRegex:I[0],catchers:I[1],callback:I[2],help:I[3],handler:g[y.indexOf(I)],display:!!v},U=0;U<I[1].length;U++)$.formatted.push(d.getStandard(x[U+1],I[1][U]));var P=I[2].call(d,$),j=!1;return'number'==typeof P?P=j.toString():P&&P instanceof HTMLElement?(P=j.innerHTML,j=!0):'string'!=typeof P&&!1!==P&&(P='Sorry, I encountered a problem. Please try again.'),v&&!1!==P&&d.says(P,j),h&&!1!==P&&p.push([Date.now(),$.requestWithSpaces,$.handler,$.caught.slice(0),$.display]),L.did&&L.did(p.slice(-1)[0],JSON.parse(JSON.stringify($)),P),P}}catch(I){A=!0,M=I}finally{try{!S&&k.return&&k.return()}finally{if(A)throw M}}d.says('I didn\'t understand your request.',!0)},this.nowRemembersMessages=function(){h=!0},this.doesntRememberMessages=function(){h=!1},this.getMessage=function(){var _=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if('number'!=typeof _||Math.floor(_)!==_)throw new Error('[Lisa] Invalid ID given while getting message');if(0>_&&(_=-_),u.length<=_)throw new Error('[Lisa] There is no message with id "'+_+'"');return u.slice(0)},this.export=function(){var _=[],v=!0,T=!1,x=void 0;try{for(var A,M,S=y[Symbol.iterator]();!(v=(A=S.next()).done);v=!0)M=A.value,_.push([M[0].toString(),M[1],M[2].toString(),M[3]])}catch(M){T=!0,x=M}finally{try{!v&&S.return&&S.return()}finally{if(T)throw x}}return JSON.stringify({memory:m,handled:g,handlers:_,rememberMessages:h,messages:u,requests:p})},this.learns('HOURS_NAME','hours'),this.learns('MINUTES_NAME','minutes'),this.learns('SECONDS_NAME','secondes'),this.learns('MONTHS','january,february,march,april,may,june,july,august,september,october,november,december'),this.__defineGetter__('dom',function(){return l}),this.__defineGetter__('memory',function(){return JSON.parse(JSON.stringify(m))}),this.__defineGetter__('messages',function(){return JSON.parse(JSON.stringify(u))}),this.__defineGetter__('history',function(){return JSON.parse(JSON.stringify(p))}),this.__defineGetter__('remembersMessages',function(){return h}),this.__defineSetter__('remembersMessages',function(_){return _?d.nowRemembersMessages():d.doesntRememberMessages()})},LZString=function(){function t(h,m){if(!u[h]){u[h]={};for(var g=0;g<h.length;g++)u[h][h.charAt(g)]=g}return u[h][m]}var r=String.fromCharCode,d='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',l='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$',u={},p={compressToBase64:function compressToBase64(h){if(null==h)return'';var m=p._compress(h,6,function(g){return d.charAt(g)});switch(m.length%4){default:case 0:return m;case 1:return m+'===';case 2:return m+'==';case 3:return m+'=';}},decompressFromBase64:function decompressFromBase64(h){return null==h?'':''==h?null:p._decompress(h.length,32,function(m){return t(d,h.charAt(m))})},compressToUTF16:function compressToUTF16(h){return null==h?'':p._compress(h,15,function(m){return r(m+32)})+' '},decompressFromUTF16:function decompressFromUTF16(h){return null==h?'':''==h?null:p._decompress(h.length,16384,function(m){return h.charCodeAt(m)-32})},compressToUint8Array:function compressToUint8Array(h){for(var _,m=p.compress(h),g=new Uint8Array(2*m.length),y=0,L=m.length;y<L;y++)_=m.charCodeAt(y),g[2*y]=_>>>8,g[2*y+1]=_%256;return g},decompressFromUint8Array:function decompressFromUint8Array(h){if(null===h||h===void 0)return p.decompress(h);var m=function(){for(var g=Array(h.length/2),L=0,_=g.length;L<_;L++)g[L]=256*h[2*L]+h[2*L+1];var y=[];return g.forEach(function(L){y.push(r(L))}),{v:p.decompress(y.join(''))}}();if('object'===('undefined'==typeof m?'undefined':_typeof(m)))return m.v},compressToEncodedURIComponent:function compressToEncodedURIComponent(h){return null==h?'':p._compress(h,6,function(m){return l.charAt(m)})},decompressFromEncodedURIComponent:function decompressFromEncodedURIComponent(h){return null==h?'':''==h?null:(h=h.replace(/ /g,'+'),p._decompress(h.length,32,function(m){return t(l,h.charAt(m))}))},compress:function compress(h){return p._compress(h,16,function(m){return r(m)})},_compress:function _compress(h,m,g){if(null==h)return'';var y=void 0,L,_={},v={},T='',x='',S='',A=2,M=3,k=2,O=[],I=0,$=0,P;for(P=0;P<h.length;P+=1)if(T=h.charAt(P),Object.prototype.hasOwnProperty.call(_,T)||(_[T]=M++,v[T]=!0),x=S+T,Object.prototype.hasOwnProperty.call(_,x))S=x;else{if(Object.prototype.hasOwnProperty.call(v,S)){if(256>S.charCodeAt(0)){for(y=0;y<k;y++)I<<=1,$==m-1?($=0,O.push(g(I)),I=0):$++;for(L=S.charCodeAt(0),y=0;8>y;y++)I=I<<1|1&L,$==m-1?($=0,O.push(g(I)),I=0):$++,L>>=1}else{for(L=1,y=0;y<k;y++)I=I<<1|L,$==m-1?($=0,O.push(g(I)),I=0):$++,L=0;for(L=S.charCodeAt(0),y=0;16>y;y++)I=I<<1|1&L,$==m-1?($=0,O.push(g(I)),I=0):$++,L>>=1}A--,0==A&&(A=Math.pow(2,k),k++),delete v[S]}else for(L=_[S],y=0;y<k;y++)I=I<<1|1&L,$==m-1?($=0,O.push(g(I)),I=0):$++,L>>=1;A--,0==A&&(A=Math.pow(2,k),k++),_[x]=M++,S=T+''}if(''!==S){if(Object.prototype.hasOwnProperty.call(v,S)){if(256>S.charCodeAt(0)){for(y=0;y<k;y++)I<<=1,$==m-1?($=0,O.push(g(I)),I=0):$++;for(L=S.charCodeAt(0),y=0;8>y;y++)I=I<<1|1&L,$==m-1?($=0,O.push(g(I)),I=0):$++,L>>=1}else{for(L=1,y=0;y<k;y++)I=I<<1|L,$==m-1?($=0,O.push(g(I)),I=0):$++,L=0;for(L=S.charCodeAt(0),y=0;16>y;y++)I=I<<1|1&L,$==m-1?($=0,O.push(g(I)),I=0):$++,L>>=1}A--,0==A&&(A=Math.pow(2,k),k++),delete v[S]}else for(L=_[S],y=0;y<k;y++)I=I<<1|1&L,$==m-1?($=0,O.push(g(I)),I=0):$++,L>>=1;A--,0==A&&(A=Math.pow(2,k),k++)}for(L=2,y=0;y<k;y++)I=I<<1|1&L,$==m-1?($=0,O.push(g(I)),I=0):$++,L>>=1;for(;;)if(I<<=1,$==m-1){O.push(g(I));break}else $++;return O.join('')},decompress:function decompress(h){return null==h?'':''==h?null:p._decompress(h.length,32768,function(m){return h.charCodeAt(m)})},_decompress:function _decompress(h,m,g){var y=[],L,_=4,v=4,T=3,x='',S=[],A,M,k,O,I,$,P,j={val:g(0),position:m,index:1};for(A=0;3>A;A+=1)y[A]=A;for(k=0,I=Math.pow(2,2),$=1;$!=I;)O=j.val&j.position,j.position>>=1,0==j.position&&(j.position=m,j.val=g(j.index++)),k|=(0<O?1:0)*$,$<<=1;switch(L=k){case 0:for(k=0,I=Math.pow(2,8),$=1;$!=I;)O=j.val&j.position,j.position>>=1,0==j.position&&(j.position=m,j.val=g(j.index++)),k|=(0<O?1:0)*$,$<<=1;P=r(k);break;case 1:for(k=0,I=Math.pow(2,16),$=1;$!=I;)O=j.val&j.position,j.position>>=1,0==j.position&&(j.position=m,j.val=g(j.index++)),k|=(0<O?1:0)*$,$<<=1;P=r(k);break;case 2:return'';}for(y[3]=P,M=P,S.push(P);;){if(j.index>h)return'';for(k=0,I=Math.pow(2,T),$=1;$!=I;)O=j.val&j.position,j.position>>=1,0==j.position&&(j.position=m,j.val=g(j.index++)),k|=(0<O?1:0)*$,$<<=1;switch(P=k){case 0:for(k=0,I=Math.pow(2,8),$=1;$!=I;)O=j.val&j.position,j.position>>=1,0==j.position&&(j.position=m,j.val=g(j.index++)),k|=(0<O?1:0)*$,$<<=1;y[v++]=r(k),P=v-1,_--;break;case 1:for(k=0,I=Math.pow(2,16),$=1;$!=I;)O=j.val&j.position,j.position>>=1,0==j.position&&(j.position=m,j.val=g(j.index++)),k|=(0<O?1:0)*$,$<<=1;y[v++]=r(k),P=v-1,_--;break;case 2:return S.join('');}if(0==_&&(_=Math.pow(2,T),T++),y[P])x=y[P];else if(P===v)x=M+M.charAt(0);else return null;S.push(x),y[v++]=M+x.charAt(0),_--,M=x,0==_&&(_=Math.pow(2,T),T++)}}};return p}();Lisa.dom.setAttribute('id','discuss'),document.body.appendChild(Lisa.dom);var input=document.createElement('input');input.setAttribute('id','input'),input.addEventListener('keydown',function(t){if(13===t.keyCode){if(!input.value.length)return;var r=input.value;input.value='',Lisa.hears(r),Lisa.does(r)}}),document.body.appendChild(input);function loadState(t){if('object'!==('undefined'==typeof t?'undefined':_typeof(t))||!t||Array.isArray(t))throw new Error('[Lisa:load] State to load must be an object');if(!Array.isArray(t.handlers)||'object'!==_typeof(t.memory)||!t.memory||Array.isArray(t.memory)||!Array.isArray(t.messages)||'boolean'!=typeof t.histories)throw new Error('[Lisa:load] Fields are missing or corrupted in the state object');var r=!0,d=!1,l=void 0;try{for(var p,u=t.handlers[Symbol.iterator]();!(r=(p=u.next()).done);r=!0){var A=p.value,M=A[1].match(/^function.*?\((?:(?: |\n)*)([a-zA-Z][a-zA-Z0-9_]*|)(?:\n\/\*\*\/|)(?:(?: |\n)*)\)(?:(?: |\n)*)\{((?:.|\n)*)\}$/);Lisa.understands(A[0],new Function([M[1]],M[2]),null,A[2])}}catch(A){d=!0,l=A}finally{try{!r&&u.return&&u.return()}finally{if(d)throw l}}var h=!0,m=!1,g=void 0;try{for(var L,A,y=Reflect.ownKeys(t.memory)[Symbol.iterator]();!(h=(L=y.next()).done);h=!0)A=L.value,'$'===A||(t.memory.$.hasOwnProperty(A)?Lisa.learnsList(A,t.memory[A],t.memory.$[A]):Lisa.learns(A,t.memory[A]))}catch(A){m=!0,g=A}finally{try{!h&&y.return&&y.return()}finally{if(m)throw g}}Lisa.remembersMessages=!0;var _=!0,v=!1,T=void 0;try{for(var S,A,x=t.messages[Symbol.iterator]();!(_=(S=x.next()).done);_=!0)A=S.value,Lisa.displayMessage(A[1],A[2],A[3])}catch(A){v=!0,T=A}finally{try{!_&&x.return&&x.return()}finally{if(v)throw T}}Lisa.rememberMessages=t.histories}function saveState(){for(var t=JSON.parse(Lisa.export()),r={handlers:[],memory:t.memory,messages:t.messages},d=0;d<t.handlers.length;d++)r.handlers.push([t.handled[d],t.handlers[d][2],t.handlers[d][3]]);r.histories=Lisa.remembersMessages,r=JSON.stringify(r),t=null,r<102400?localStorage.setItem('lisa_state','P'+r):localStorage.setItem('lisa_state','L'+reverse(LZString.compressToUTF16(reverse(r))))}function reverse(t){for(var r='',d=t.length-1;0<=d;d--)r+=t[d];return r}var data=localStorage.getItem('lisa_state');if(data){var t=function corrupted(){'object'===('undefined'==typeof console?'undefined':_typeof(console))&&'function'==typeof console.error&&console.error('Corrupted data found in localStorage'),('object'===('undefined'==typeof window?'undefined':_typeof(window))?window:'object'===('undefined'==typeof global?'undefined':_typeof(global))?global:'object'===_typeof(this)?this:{}).corrupted_local_lisa_state=data,localStorage.removeItem('lisa_state'),data=null};if(data.startsWith('L')?data=reverse(LZString.decompressFromUTF16(reverse(data.substr(1)))):data.startsWith('P')?data=reverse(data.substr(1)):t(),data){try{data=JSON.parse(data)}catch(r){t()}data&&loadState(data)}}Lisa.when('message',saveState),Lisa.when('did',saveState),Lisa.when('learnt',saveState),Lisa.when('forgot',saveState),Lisa.when('understood',saveState);function getXMLHttpRequest(){if(window.ActiveXObject)try{return new ActiveXObject('Msxml2.XMLHTTP')}catch(t){return new ActiveXObject('Microsoft.XMLHTTP')}else return new XMLHttpRequest}var LisaInterface={comparators:{'=':'===','==':'===',is:'===','!':'!==','!=':'!==','!==':'!==','is not':'!==',isnt:'!=='},compile:function compile(t){function r(M){throw new Error('[LIS:compile] At line '+y+' :\n'+L+'\n^\n'+M)}function d(M){return M.startsWith('_')?'_a.caught['+M.substr(1)+']':M.startsWith('^')?'_a.formatted['+M.substr(1)+']':M.match(/^([a-zA-Z][a-zA-Z0-9_]*)$/)?'Lisa.thinksTo("'+M+'")':M}function l(){for(var M=0;M<h-m;M++)_.includes(h-M-1)?(p+='return false;});',_.splice(_.indexOf(h-M-1),1)):p+='}';h=m}if('string'!=typeof t)throw new Error('[LIS:compile] Invalid source code provided, must be a string');var m,g,u=t.split(/\r\n|\r|\n/g),p='',h=0,y=0,L=void 0,_=[],v=!0,T=!1,x=void 0;try{for(var A,S=u[Symbol.iterator]();!(v=(A=S.next()).done);v=!0)L=A.value,y++,m=L.match(/^(  |\t)*/)[0].replace(/  /g,'\t').length,L=L.trim(),L&&(h&&(m>h?r('Wrong indentation, expecting '+h+' tab'+(1<h?'s':'')+' but '+m+' given.'):m<h&&l()),!h&&m&&r('Wrong indentation, expecting no tab'),(g=L.match(/^else +/))&&(p+='else ',L=L.substr(g[0].length)),'else'===L?(p+='else{',h++):(g=L.match(/^if( +NOT *|) +([a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+)$/))?(p+='if('+(g[1]?'!':'')+d(g[2])+'){',h++):(g=L.match(/^if( +NOT *|) +knows +([a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+)$/))?(p+='if('+(g[1]?'!':'')+'Lisa.knows("'+g[2]+'")){',h++):(g=L.match(/^if( +NOT *|) +(islist|is_list|list) +([a-zA-Z[a-zA-Z0-9_]*)$/))?(p+='if('+(g[1]?'!':'')+'Lisa.isList("'+g[3]+'")){',h++):(g=L.match(/^if +([a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+) *(<=|>=|<|>) *(\d+[.]?|\d*\.\d+)$/))?(p+='if(Lisa.thinksTo("'+g[1]+'")'+g[2]+g[3]+'){',h++):(g=L.match(/^if +("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+) *(=|==|\!|\!=|\!==|is not|isnt|is) *("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+)$/))?(p+='if('+d(g[1])+this.comparators[g[2]]+d(g[3])+'){',h++):(g=L.match(/^say +"(.*)"$/))?p+='Lisa.says("'+g[1].replace(/%_(\d|[1-9]\d*)%/g,'"+_a.caught[$1]+"').replace(/%\^(\d|[1-9]\d*)%/g,'"+_a.formatted[$1]+"')+'");':(g=L.match(/^(end|return|die|output) +("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+)$/))?p+='return '+d(g[2])+';':(g=L.match(/^(store|set|learn|rem|remember|mem|memorize|save)[s]? +("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+) *=> *([a-zA-Z][a-zA-Z0-9_]*)$/))?p+='Lisa.learns("'+g[3]+'",'+d(g[2])+');':(g=L.match(/^"(.*)" *=>$/))?(p+='Lisa.understands("'+g[1]+'",function(){var _a=arguments[0];',_.push(h),h++):(g=L.match(/^(unstore|unset|unlearn|unremember|unmemorize|unsave|forget)[s]? +([a-zA-Z][a-zA-Z0-9_]*)$/))?p+='Lisa.forgets("'+g[2]+'");':(g=L.match(/^(makelist|createlist|setlist) +(bool|boolean|int|integer|float|floating|str|string) +([a-zA-Z][a-zA-Z0-9_]*)$/))?p+='Lisa.learnsList("'+g[3]+'",[],"'+g[2]+'");':(g=L.match(/^(pushlist|push|append|add) +("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+) +in +([a-zA-Z][a-zA-Z0-9_]*)$/))?p+='Lisa.learnsListValue("'+g[3]+'",'+d(g[2])+');':r('Syntax error'))}catch(M){T=!0,x=M}finally{try{!v&&S.return&&S.return()}finally{if(T)throw x}}return m=0,l(),p},exec:function exec(t){new Function([],this.compile(t))()},download:function download(t){var r=this,d=void 0;if('string'!=typeof t||!t)throw new Error('[LIS:download] Illegal URL provided, must be a not-empty string');if(t.startsWith('file://'))throw new Error('[LIS:download] Protocol "file:///" is forbidden: Lisa is not allowed to load local computer\'s resources');(d=t.match(/^presets?:\/\/\/?((?:[a-zA-Z_0-9][\/\\]?)+)(\.lis|)$/))&&(t=location.href.split('/').slice(0,-1).join('/')+'/presets/'+d[1].split('\\').join('/')+'.lis');var l=getXMLHttpRequest();l.open('GET',t,!0),l.addEventListener('readystatechange',function(){if(4===l.readyState)if(200===l.status)r.exec(l.responseText);else throw new Error('[LIS:download] Failed to download the LIS program (status code: '+l.status+')')}),l.send(null)}};
