"use strict";function loadState(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e))||!e||Array.isArray(e))throw new Error("[Lisa:load] State to load must be an object");if(!Array.isArray(e.handlers)||"object"!==_typeof(e.memory)||!e.memory||Array.isArray(e.memory)||!Array.isArray(e.messages)||"boolean"!=typeof e.histories)throw new Error("[Lisa:load] Fields are missing or corrupted in the state object");var t=!0,r=!1,n=void 0;try{for(var o,i=e.handlers[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value,s=a[1].match(/^function.*?\((?:(?: |\n)*)([a-zA-Z][a-zA-Z0-9_]*|)(?:\n\/\*\*\/|)(?:(?: |\n)*)\)(?:(?: |\n)*)\{((?:.|\n)*)\}$/);Lisa.understands(a[0],new Function([s[1]],s[2]),null,a[2])}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}var l=!0,u=!1,c=void 0;try{for(var d,f=Reflect.ownKeys(e.memory)[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var h=d.value;"$"!==h&&(e.memory.$.hasOwnProperty(h)?Lisa.learnsList(h,e.memory[h],e.memory.$[h]):Lisa.learns(h,e.memory[h]))}}catch(e){u=!0,c=e}finally{try{!l&&f.return&&f.return()}finally{if(u)throw c}}Lisa.remembersMessages=!0;var p=!0,m=!1,g=void 0;try{for(var y,v=e.messages[Symbol.iterator]();!(p=(y=v.next()).done);p=!0){var w=y.value;Lisa.displayMessage(w[1],w[2],w[3])}}catch(e){m=!0,g=e}finally{try{!p&&v.return&&v.return()}finally{if(m)throw g}}Lisa.rememberMessages=e.histories}function saveState(){for(var e=JSON.parse(Lisa.export()),t={handlers:[],memory:e.memory,messages:e.messages},r=0;r<e.handlers.length;r++)t.handlers.push([e.handled[r],e.handlers[r][2],e.handlers[r][3]]);t.histories=Lisa.remembersMessages,t=JSON.stringify(t),e=null,t<102400?localStorage.setItem("lisa_state","P"+t):localStorage.setItem("lisa_state","L"+reverse(LZString.compressToUTF16(reverse(t))))}function reverse(e){for(var t="",r=e.length-1;r>=0;r--)t+=e[r];return t}function getXMLHttpRequest(){if(!window.ActiveXObject)return new XMLHttpRequest;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){return new ActiveXObject("Microsoft.XMLHTTP")}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},RegexCatchers={"*":function(){return"(.*?)"},number:function(){return"(\\d+[.]?|\\d*\\.\\d+)"},integer:function(){return"(\\d+)"},short_time:function(){return"((?:[01]?\\d|2[0-3])(?: *: *| +"+Lisa.thinksTo("HOURS_NAME")+" +)[0-5]\\d(?:| +"+Lisa.thinksTo("MINUTES_NAME")+"))"},time:function(){return"((?:[01]?\\d|2[0-3])(?: *: *| +"+Lisa.thinksTo("HOURS_NAME")+" +)[0-5]\\d(?: *: *| +"+Lisa.thinksTo("MINUTES_NAME")+" +)[0-5]\\d))(?:|"+Lisa.thinksTo("SECONDS_NAME")+")"},short_date:function(){return"((?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *[\\/\\-\\.] *| +(?:"+Lisa.thinksTo("MONTHS").split(",").join("|")+"))"},date:function(){return"((?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *[\\/\\-\\.] *| +(?:"+Lisa.thinksTo("MONTHS").split(",").join("|")+") +)\\d{4})"}},Lisa=new function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"0".repeat(t-e.length)+e}function t(e,t){switch(t){case"boolean":return e===!1||e===!0;case"integer":return!("number"!=typeof e||Math.floor(e)!==e||e<0);case"floating":return"number"==typeof e;case"string":return"string"==typeof e}}var r=this,n=document.createElement("div"),o=[],i=[],a=!0,s={$:{}},l=[],u=[],c={message:null,did:null,learnt:null,forgot:null,understood:null};this.escapeHtml=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},this.getStandard=function(t,r){if(!RegexCatchers.hasOwnProperty(r)&&"?"!==r)throw new Error('[Lisa] Unknown catcher "'+r+'"');if(["*","?","number","integer"].includes(r))return t;var n=void 0;switch(r){case"short_time":return t.replace(/^([0-9]+).*([0-9]+)$/,function(t,r,n){return e(r)+":"+e(n)});case"time":return t.replace(/^([0-9]+).*([0-9]+).*([0-9]+)$/,e($1)+":"+e($2)+":"+e($3));case"short_date":n=Lisa.thinksTo("MONTHS").split(",");for(var o=function(r){if(t.includes(n))return{v:t.replace(/\d+/,function(t){return e(t)+"/"+e(r.toString())})}},i=0;i<n.length;i++){var a=o(i);if("object"===("undefined"==typeof a?"undefined":_typeof(a)))return a.v}return t.replace(/(\d+).*?(\d+)/,function(t,r,n){return e(r)+"/"+e(n)});case"date":n=Lisa.thinksTo("MONTHS").split(",");for(var s=function(r){if(t.includes(n[r]))return{v:t.replace(/(\d+).*?(\d+)/,function(t,n,o){return e(n)+"/"+e((r+1).toString())+"/"+e(o,4)})}},i=0;i<n.length;i++){var l=s(i);if("object"===("undefined"==typeof l?"undefined":_typeof(l)))return l.v}return t.replace(/(\d+).*?(\d+).*?(\d+)/,function(t,r,n,o){return e(r)+"/"+e(n)+"/"+e(o,4)});default:throw new Error('[Lisa] [BUG] Unreferenced catcher "'+r+'"')}},this.format=function(e){return r.escapeHtml(e).replace(/\*(.*?)\*/g,"<strong>$1</strong>").replace(/_(.*?)_/g,"<em>$1</em>").replace(/~(.*?)~/g,"<del>$1</del>").replace(/%([a-zA-Z][a-zA-Z0-9_]*)%/g,function(t,r){if(Lisa.knows(r))return Lisa.thinksTo(r);throw new Error('[Lisa] Variable "'+r+'" is not defined in message "'+e+'"')})},this.makeHandlerRegex=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[],n=new RegExp("^"+e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/ /g," +").replace(/\\\{(.*?)\\\}/g,function(e,t){if(t.startsWith("\\?"))return r.push("?"),t.substr(2).includes("\\|")?":"===t.substr(2,1)?"("+t.substr(3).split("\\|").join("|")+"|)":"("+t.substr(2).split("\\|").join("|")+")":"("+t.substr(2)+"|)";if("\\*"===t&&(t="*"),!RegexCatchers.hasOwnProperty(t))throw new Error('[Lisa] Unknown catcher "'+t+'"');return r.push(t),RegexCatchers[t]()}).replace(/( \+)?\\\.$/," *(?:[\\.]*)?").replace(/( \+)?\\\?$/," *(?:[\\?]*)?")+"(?: *[!\\.])*$","i");return t?[n,r]:n},this.when=function(e,t){if(!c.hasOwnProperty(e))throw new Error("[Lisa] Unknown event name");if("function"!=typeof t)throw new Error("[Lisa] Illegal callback provided, must be a function");c[e]=t},this.understands=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments[3];if(l.includes(e))throw new Error("[Lisa] Handler is already in use");if("string"==typeof t)t=new Function([],Reflect.ownKeys(n).map(function(e){return'Lisa.learns("'+e+'","'+n[e].replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function(e,t){return'"+arguments[0].formatted['+t+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function(e,t){return'"+arguments[0].caught['+t+']+"'})+'");'})+'return "'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function(e,t){return'"+arguments[0].formatted['+t+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function(e,t){return'"+arguments[0].caught['+t+']+"'})+'"');else{if("function"!=typeof t)throw new Error("[Lisa] Illegal handler's callback provided");if(n){var i=t;t=new Function(["requested"],"("+function(e){var t=!0,r=!1,n=void 0;try{for(var o,i=Reflect.ownKeys(e)[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;Lisa.learns(a,e[a].replace(/\$\^(\d|[1-9]\d+)/g,function(e,t){return requested.formatted[t]}).replace(/\$_(\d|[1-9]\d+)/g,function(e,t){return requested.caught[t]}))}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}}.toString()+")("+JSON.stringify(n)+");return ("+i.toString()+")(requested);")}}var a=r.makeHandlerRegex(e,!0);if(o){if(!Array.isArray(o))throw new Error("[Lisa] Illegal help text argument provided");if(o.length!==a[1].length)throw new Error('[Lisa] Insufficient help for parameters in handler "'+e+'"');var s=!0,d=!1,f=void 0;try{for(var h,p=o[Symbol.iterator]();!(s=(h=p.next()).done);s=!0){var m=h.value;if(!["string","function"].includes("undefined"==typeof m?"undefined":_typeof(m)))throw new Error('[Lisa] Illegal help text given for handler "'+e+'"')}}catch(e){d=!0,f=e}finally{try{!s&&p.return&&p.return()}finally{if(d)throw f}}}return u.push([a[0],a[1],t,o||null]),l.push(e),c.understood&&c.understood(new RegExp(a[0].toString().slice(1,-2)),a[1].slice(0),t,o?o.slice(0):null),a[0]},this.displayMessage=function(e,t,i){var s=document.createElement("div");s.setAttribute("class","message message-"+i),s.innerHTML="<strong>"+e+" : </strong>"+r.format(t),n.appendChild(s);var l=n.scrollHeight-n.scrollTop,u=setInterval(function(){return n.scrollTop++},Math.floor(2e3/l));setTimeout(function(){return clearInterval(u)},2e3),a&&o.push([Date.now(),e,t,i]),c.message&&c.message(Date.now(),e,t,i)},this.helpsAbout=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!l.includes(e))throw new Error('[Lisa] Unknown handler "'+e+'"');var r=u[l.indexOf(e)][3];if(!r)return!1;if(t)return r.slice(0);var n=0;return e.replace(/\{(.*?)\}/g,function(e){return"["+r[n++]+"]"})},this.learns=function(e,t){if("string"!=typeof e||!e.length||{}[e]||"$"===e)throw new Error("[Lisa] Illegal name provided for memory's cell");if(!["string","number","boolean"].includes("undefined"==typeof t?"undefined":_typeof(t)))throw new Error("[Lisa] Illegal value provided for memory's cell \""+e+'"');s.$.hasOwnProperty(e)&&delete s.$[e],s[e]=t,c.learnt&&c.learnt(e,t)},this.learnsList=function(e,r,n){if("string"!=typeof e||!e.length||{}[e]||"$"===e)throw new Error("[Lisa] Illegal name provided for memory's cell");if(n={bool:"boolean",int:"integer",float:"floating",str:"string"}[n]||n,!["boolean","integer","floating","string"].includes(n))throw new Error('[Lisa] Unknown type "'+n+'", must be "boolean", "integer", "floating" or "string"');if(!Array.isArray(r))throw new Error("[Lisa] Illegal list provided, must be an array");r=r.slice(0);for(var o=0;o<r.length;o++)if(!t(r[o],n))throw new Error("[Lisa] Value at index "+o+" is not a "+n);s[e]=r,s.$[e]=n,c.learnt&&c.learnt(e,r.slice(0))},this.learnsBoolList=function(e,t){return r.learnsList(e,t,"boolean")},this.learnsIntList=function(e,t){return r.learnsList(e,t,"integer")},this.learnsFloatList=function(e,t){return r.learnsList(e,t,"floating")},this.learnsStrList=function(e,t){return r.learnsList(e,t,"string")},this.thinksToList=function(e){return s.$.hasOwnProperty(e)?s[e].slice(0):void 0},this.thinksToListValue=function(e,t){return s.$.hasOwnProperty(e)&&s[e].length>t?s[e][t]:void 0},this.thinksToListType=function(e){return s.$.hasOwnProperty(e)?s.$[e]:void 0},this.learnsListValue=function(e,r){if(!s.$.hasOwnProperty(e))throw new Error('[Lisa] Unknown list "'+e+'"');if(!t(r,s.$[e]))throw new Error('[Lisa] Provided value for list "'+e+'" is not an '+s.$[e]);s[e].push(r),c.learnt&&c.learnt(e,r,s[e].length-1)},this.knows=function(e){return"$"!==e&&s.hasOwnProperty(e)},this.knowsValue=function(e){return Object.values(s).includes(e)},this.knowsValueInList=function(e,t){return s.$.hasOwnProperty(e)&&s[e].includes(t)},this.searchesValue=function(e,t){var r=!0,n=!1,o=void 0;try{for(var i,a=Reflect.ownKeys(s)[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var l=i.value;if(s[l]===e)return l;if(s.$[l]){if(!t)continue;if(s[l].includes(e))return l}}}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}return!1},this.isList=function(e){return s.$.hasOwnProperty(e)},this.thinksTo=function(e){return s.hasOwnProperty(e)&&"$"!==e?Array.isArray(s[e])?s[e].join(";"):s[e]:void 0},this.forgets=function(e){if(!s.hasOwnProperty(e)||"$"===e)throw new Error("[Lisa] Can't forget unexisting cell");var t=s[e];return delete s[e],delete s.$[e],c.forgot&&c.forgot(e,t),t},this.thinksToListLength=function(e){return s.$.hasOwnProperty(e)?s[e].length:void 0},this.says=function(e){return r.displayMessage("Lisa",e,"lisa")},this.hears=function(e){return r.displayMessage("You",e,"user")},this.does=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e;e=e.trim();var o=void 0,s=!0,d=!1,f=void 0;try{for(var h,p=u[Symbol.iterator]();!(s=(h=p.next()).done);s=!0){var m=h.value;if(o=e.match(m[0])){for(var g={request:e,requestWithSpaces:n,caught:o.slice(1),formatted:[],handlerRegex:m[0],catchers:m[1],callback:m[2],help:m[3],handler:l[u.indexOf(m)],display:!!t},y=0;y<m[1].length;y++)g.formatted.push(r.getStandard(o[y+1],m[1][y]));var v=m[2].call(r,g),w=!1;return"number"==typeof v?v=w.toString():v&&v instanceof HTMLElement?(v=w.innerHTML,w=!0):"string"!=typeof v&&v!==!1&&(v="Sorry, I encountered a problem. Please try again."),t&&v!==!1&&r.says(v,w),a&&v!==!1&&i.push([Date.now(),g.requestWithSpaces,g.handler,g.caught.slice(0),g.display]),c.did&&c.did(i.slice(-1)[0],JSON.parse(JSON.stringify(g)),v),v}}}catch(e){d=!0,f=e}finally{try{!s&&p.return&&p.return()}finally{if(d)throw f}}r.says("I didn't understand your request.",!0)},this.nowRemembersMessages=function(){a=!0},this.doesntRememberMessages=function(){a=!1},this.getMessage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("number"!=typeof e||Math.floor(e)!==e)throw new Error("[Lisa] Invalid ID given while getting message");if(e<0&&(e=-e),o.length<=e)throw new Error('[Lisa] There is no message with id "'+e+'"');return o.slice(0)},this.export=function(){var e=[],t=!0,r=!1,n=void 0;try{for(var c,d=u[Symbol.iterator]();!(t=(c=d.next()).done);t=!0){var f=c.value;e.push([f[0].toString(),f[1],f[2].toString(),f[3]])}}catch(e){r=!0,n=e}finally{try{!t&&d.return&&d.return()}finally{if(r)throw n}}return JSON.stringify({memory:s,handled:l,handlers:e,rememberMessages:a,messages:o,requests:i})},this.learns("HOURS_NAME","hours"),this.learns("MINUTES_NAME","minutes"),this.learns("SECONDS_NAME","secondes"),this.learns("MONTHS","january,february,march,april,may,june,july,august,september,october,november,december"),this.__defineGetter__("dom",function(){return n}),this.__defineGetter__("memory",function(){return JSON.parse(JSON.stringify(s))}),this.__defineGetter__("messages",function(){return JSON.parse(JSON.stringify(o))}),this.__defineGetter__("history",function(){return JSON.parse(JSON.stringify(i))}),this.__defineGetter__("remembersMessages",function(){return a}),this.__defineSetter__("remembersMessages",function(e){return e?r.nowRemembersMessages():r.doesntRememberMessages()})},LZString=function(){function e(e,t){if(!o[e]){o[e]={};for(var r=0;r<e.length;r++)o[e][e.charAt(r)]=r}return o[e][t]}var t=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={},i={compressToBase64:function(e){if(null==e)return"";var t=i._compress(e,6,function(e){return r.charAt(e)});switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:i._decompress(t.length,32,function(n){return e(r,t.charAt(n))})},compressToUTF16:function(e){return null==e?"":i._compress(e,15,function(e){return t(e+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:i._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=i.compress(e),r=new Uint8Array(2*t.length),n=0,o=t.length;n<o;n++){var a=t.charCodeAt(n);r[2*n]=a>>>8,r[2*n+1]=a%256}return r},decompressFromUint8Array:function(e){if(null===e||void 0===e)return i.decompress(e);var r=function(){for(var r=new Array(e.length/2),n=0,o=r.length;n<o;n++)r[n]=256*e[2*n]+e[2*n+1];var a=[];return r.forEach(function(e){a.push(t(e))}),{v:i.decompress(a.join(""))}}();return"object"===("undefined"==typeof r?"undefined":_typeof(r))?r.v:void 0},compressToEncodedURIComponent:function(e){return null==e?"":i._compress(e,6,function(e){return n.charAt(e)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),i._decompress(t.length,32,function(r){return e(n,t.charAt(r))}))},compress:function(e){return i._compress(e,16,function(e){return t(e)})},_compress:function(e,t,r){if(null==e)return"";var n=void 0,o=void 0,i={},a={},s="",l="",u="",c=2,d=3,f=2,h=[],p=0,m=0,g=void 0;for(g=0;g<e.length;g+=1)if(s=e.charAt(g),Object.prototype.hasOwnProperty.call(i,s)||(i[s]=d++,a[s]=!0),l=u+s,Object.prototype.hasOwnProperty.call(i,l))u=l;else{if(Object.prototype.hasOwnProperty.call(a,u)){if(u.charCodeAt(0)<256){for(n=0;n<f;n++)p<<=1,m==t-1?(m=0,h.push(r(p)),p=0):m++;for(o=u.charCodeAt(0),n=0;n<8;n++)p=p<<1|1&o,m==t-1?(m=0,h.push(r(p)),p=0):m++,o>>=1}else{for(o=1,n=0;n<f;n++)p=p<<1|o,m==t-1?(m=0,h.push(r(p)),p=0):m++,o=0;for(o=u.charCodeAt(0),n=0;n<16;n++)p=p<<1|1&o,m==t-1?(m=0,h.push(r(p)),p=0):m++,o>>=1}c--,0==c&&(c=Math.pow(2,f),f++),delete a[u]}else for(o=i[u],n=0;n<f;n++)p=p<<1|1&o,m==t-1?(m=0,h.push(r(p)),p=0):m++,o>>=1;c--,0==c&&(c=Math.pow(2,f),f++),i[l]=d++,u=String(s)}if(""!==u){if(Object.prototype.hasOwnProperty.call(a,u)){if(u.charCodeAt(0)<256){for(n=0;n<f;n++)p<<=1,m==t-1?(m=0,h.push(r(p)),p=0):m++;for(o=u.charCodeAt(0),n=0;n<8;n++)p=p<<1|1&o,m==t-1?(m=0,h.push(r(p)),p=0):m++,o>>=1}else{for(o=1,n=0;n<f;n++)p=p<<1|o,m==t-1?(m=0,h.push(r(p)),p=0):m++,o=0;for(o=u.charCodeAt(0),n=0;n<16;n++)p=p<<1|1&o,m==t-1?(m=0,h.push(r(p)),p=0):m++,o>>=1}c--,0==c&&(c=Math.pow(2,f),f++),delete a[u]}else for(o=i[u],n=0;n<f;n++)p=p<<1|1&o,m==t-1?(m=0,h.push(r(p)),p=0):m++,o>>=1;c--,0==c&&(c=Math.pow(2,f),f++)}for(o=2,n=0;n<f;n++)p=p<<1|1&o,m==t-1?(m=0,h.push(r(p)),p=0):m++,o>>=1;for(;;){if(p<<=1,m==t-1){h.push(r(p));break}m++}return h.join("")},decompress:function(e){return null==e?"":""==e?null:i._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(e,r,n){var o=[],i=void 0,a=4,s=4,l=3,u="",c=[],d=void 0,f=void 0,h=void 0,p=void 0,m=void 0,g=void 0,y=void 0,v={val:n(0),position:r,index:1};for(d=0;d<3;d+=1)o[d]=d;for(h=0,m=Math.pow(2,2),g=1;g!=m;)p=v.val&v.position,v.position>>=1,0==v.position&&(v.position=r,v.val=n(v.index++)),h|=(p>0?1:0)*g,g<<=1;switch(i=h){case 0:for(h=0,m=Math.pow(2,8),g=1;g!=m;)p=v.val&v.position,v.position>>=1,0==v.position&&(v.position=r,v.val=n(v.index++)),h|=(p>0?1:0)*g,g<<=1;y=t(h);break;case 1:for(h=0,m=Math.pow(2,16),g=1;g!=m;)p=v.val&v.position,v.position>>=1,0==v.position&&(v.position=r,v.val=n(v.index++)),h|=(p>0?1:0)*g,g<<=1;y=t(h);break;case 2:return""}for(o[3]=y,f=y,c.push(y);;){if(v.index>e)return"";for(h=0,m=Math.pow(2,l),g=1;g!=m;)p=v.val&v.position,v.position>>=1,0==v.position&&(v.position=r,v.val=n(v.index++)),h|=(p>0?1:0)*g,g<<=1;switch(y=h){case 0:for(h=0,m=Math.pow(2,8),g=1;g!=m;)p=v.val&v.position,v.position>>=1,0==v.position&&(v.position=r,v.val=n(v.index++)),h|=(p>0?1:0)*g,g<<=1;o[s++]=t(h),y=s-1,a--;break;case 1:for(h=0,m=Math.pow(2,16),g=1;g!=m;)p=v.val&v.position,v.position>>=1,0==v.position&&(v.position=r,v.val=n(v.index++)),h|=(p>0?1:0)*g,g<<=1;o[s++]=t(h),y=s-1,a--;break;case 2:return c.join("")}if(0==a&&(a=Math.pow(2,l),l++),o[y])u=o[y];else{if(y!==s)return null;u=f+f.charAt(0)}c.push(u),o[s++]=f+u.charAt(0),a--,f=u,0==a&&(a=Math.pow(2,l),l++)}}};return i}();Lisa.dom.setAttribute("id","discuss"),document.body.appendChild(Lisa.dom);var input=document.createElement("input");input.setAttribute("id","input"),input.addEventListener("keydown",function(e){if(13===e.keyCode){if(!input.value.length)return;var t=input.value;input.value="",Lisa.hears(t),Lisa.does(t)}}),document.body.appendChild(input);var data=localStorage.getItem("lisa_state");if(data){var corrupted=function(){"object"===("undefined"==typeof console?"undefined":_typeof(console))&&"function"==typeof console.error&&console.error("Corrupted data found in localStorage"),("object"===("undefined"==typeof window?"undefined":_typeof(window))?window:"object"===("undefined"==typeof global?"undefined":_typeof(global))?global:"object"===_typeof(this)?this:{}).corrupted_local_lisa_state=data,localStorage.removeItem("lisa_state"),data=null};if(data.startsWith("L")?data=reverse(LZString.decompressFromUTF16(reverse(data.substr(1)))):data.startsWith("P")?data=reverse(data.substr(1)):corrupted(),data){try{data=JSON.parse(data)}catch(e){corrupted()}data&&loadState(data)}}Lisa.when("message",saveState),Lisa.when("did",saveState),Lisa.when("learnt",saveState),Lisa.when("forgot",saveState),Lisa.when("understood",saveState);var LisaInterface={comparators:{"=":"===","==":"===",is:"===","!":"!==","!=":"!==","!==":"!==","is not":"!==",isnt:"!=="},compile:function(e){function t(e){throw new Error("[LIS:compile] At line "+u+" :\n"+c+"\n^\n"+e)}function r(e){return e.startsWith("_")?"_a.caught["+e.substr(1)+"]":e.startsWith("^")?"_a.formatted["+e.substr(1)+"]":e.match(/^([a-zA-Z][a-zA-Z0-9_]*)$/)?'Lisa.thinksTo("'+e+'")':e}function n(){for(var e=0;e<a-s;e++)d.includes(a-e-1)?(i+="return false;});",d.splice(d.indexOf(a-e-1),1)):i+="}";a=s}if("string"!=typeof e)throw new Error("[LIS:compile] Invalid source code provided, must be a string");var o=e.split(/\r\n|\r|\n/g),i="",a=0,s=void 0,l=void 0,u=0,c=void 0,d=[],f=!0,h=!1,p=void 0;try{for(var m,g=o[Symbol.iterator]();!(f=(m=g.next()).done);f=!0)c=m.value,u++,s=c.match(/^(  |\t)*/)[0].replace(/  /g,"\t").length,c=c.trim(),c&&(a&&(s>a?t("Wrong indentation, expecting "+a+" tab"+(a>1?"s":"")+" but "+s+" given."):s<a&&n()),!a&&s&&t("Wrong indentation, expecting no tab"),(l=c.match(/^else +/))&&(i+="else ",c=c.substr(l[0].length)),"else"===c?(i+="else{",a++):(l=c.match(/^if( +NOT *|) +([a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+)$/))?(i+="if("+(l[1]?"!":"")+r(l[2])+"){",a++):(l=c.match(/^if( +NOT *|) +knows +([a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+)$/))?(i+="if("+(l[1]?"!":"")+'Lisa.knows("'+l[2]+'")){',a++):(l=c.match(/^if( +NOT *|) +(islist|is_list|list) +([a-zA-Z[a-zA-Z0-9_]*)$/))?(i+="if("+(l[1]?"!":"")+'Lisa.isList("'+l[3]+'")){',a++):(l=c.match(/^if +([a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+) *(<=|>=|<|>) *(\d+[.]?|\d*\.\d+)$/))?(i+='if(Lisa.thinksTo("'+l[1]+'")'+l[2]+l[3]+"){",a++):(l=c.match(/^if +("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+) *(=|==|\!|\!=|\!==|is not|isnt|is) *("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+)$/))?(i+="if("+r(l[1])+this.comparators[l[2]]+r(l[3])+"){",a++):(l=c.match(/^say +"(.*)"$/))?i+='Lisa.says("'+l[1].replace(/%_(\d|[1-9]\d*)%/g,'"+_a.caught[$1]+"').replace(/%\^(\d|[1-9]\d*)%/g,'"+_a.formatted[$1]+"')+'");':(l=c.match(/^(end|return|die|output) +("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+)$/))?i+="return "+r(l[2])+";":(l=c.match(/^(store|set|learn|rem|remember|mem|memorize|save)[s]? +("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+) *=> *([a-zA-Z][a-zA-Z0-9_]*)$/))?i+='Lisa.learns("'+l[3]+'",'+r(l[2])+");":(l=c.match(/^"(.*)" *=>$/))?(i+='Lisa.understands("'+l[1]+'",function(){var _a=arguments[0];',d.push(a),a++):(l=c.match(/^(unstore|unset|unlearn|unremember|unmemorize|unsave|forget)[s]? +([a-zA-Z][a-zA-Z0-9_]*)$/))?i+='Lisa.forgets("'+l[2]+'");':(l=c.match(/^(makelist|createlist|setlist) +(bool|boolean|int|integer|float|floating|str|string) +([a-zA-Z][a-zA-Z0-9_]*)$/))?i+='Lisa.learnsList("'+l[3]+'",[],"'+l[2]+'");':(l=c.match(/^(pushlist|push|append|add) +("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+) +in +([a-zA-Z][a-zA-Z0-9_]*)$/))?i+='Lisa.learnsListValue("'+l[3]+'",'+r(l[2])+");":t("Syntax error"))}catch(e){h=!0,p=e}finally{try{!f&&g.return&&g.return()}finally{if(h)throw p}}return s=0,n(),i},exec:function(e){new Function([],this.compile(e))()},download:function(e){var t=this,r=void 0;if("string"!=typeof e||!e)throw new Error("[LIS:download] Illegal URL provided, must be a not-empty string");if(e.startsWith("file://"))throw new Error('[LIS:download] Protocol "file:///" is forbidden: Lisa is not allowed to load local computer\'s resources');(r=e.match(/^presets?:\/\/\/?((?:[a-zA-Z_0-9][\/\\]?)+)(\.lis|)$/))&&(e=location.href.split("/").slice(0,-1).join("/")+"/presets/"+r[1].split("\\").join("/")+".lis");var n=getXMLHttpRequest();n.open("GET",e,!0),n.addEventListener("readystatechange",function(e){if(4===n.readyState){if(200!==n.status)throw new Error("[LIS:download] Failed to download the LIS program (status code: "+n.status+")");t.exec(n.responseText)}}),n.send(null)}};