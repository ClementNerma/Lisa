'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&'function'==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?'symbol':typeof t},RegexCatchers={'*':function _(){return'(.*?)'},number:function number(){return'(\\d+[.]?|\\d*\\.\\d+)'},integer:function integer(){return'(\\d+)'},short_time:function short_time(){return'((?:[01]?\\d|2[0-3])(?: *: *| +'+Lisa.thinksTo('HOURS_NAME')+' +)[0-5]\\d(?:| +'+Lisa.thinksTo('MINUTES_NAME')+'))'},time:function time(){return'((?:[01]?\\d|2[0-3])(?: *: *| +'+Lisa.thinksTo('HOURS_NAME')+' +)[0-5]\\d(?: *: *| +'+Lisa.thinksTo('MINUTES_NAME')+' +)[0-5]\\d))(?:|'+Lisa.thinksTo('SECONDS_NAME')+')'},short_date:function short_date(){return'((?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *[\\/\\-\\.] *| +(?:'+Lisa.thinksTo('MONTHS').split(',').join('|')+'))'},date:function date(){return'((?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *[\\/\\-\\.] *| +(?:'+Lisa.thinksTo('MONTHS').split(',').join('|')+') +)\\d{4})'}},Lisa=new function(){var d=this,l=document.createElement('div'),u=[],p=[],h=!0,m={$:{}},g=[],y=[],_={message:null,did:null,learnt:null,forgot:null,understood:null};function t(L){var v=1<arguments.length&&arguments[1]!==void 0?arguments[1]:2;return'0'.repeat(v-L.length)+L}function r(L,v){return'integer'===v?!('number'!=typeof L||Math.floor(L)!==L||0>L):'floating'===v?'number'==typeof L:'string'===v?'string'==typeof L:void 0}this.escapeHtml=function(L){return L.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;')},this.getStandard=function(L,v){if(!RegexCatchers.hasOwnProperty(v)&&'?'!==v)throw new Error('[Lisa] Unknown catcher "'+v+'"');if(['*','?','number','integer'].includes(v))return L;var T;switch(v){case'short_time':return L.replace(/^([0-9]+).*([0-9]+)$/,function(k,I,O){return t(I)+':'+t(O)});case'time':return L.replace(/^([0-9]+).*([0-9]+).*([0-9]+)$/,t($1)+':'+t($2)+':'+t($3));case'short_date':T=Lisa.thinksTo('MONTHS').split(',');for(var A,x=function _loop(k){if(L.includes(T))return{v:L.replace(/\d+/,function(I){return t(I)+'/'+t(k.toString())})}},k=0;k<T.length;k++)if(A=x(k),'object'===('undefined'==typeof A?'undefined':_typeof(A)))return A.v;return L.replace(/(\d+).*?(\d+)/,function(k,I,O){return t(I)+'/'+t(O)});case'date':T=Lisa.thinksTo('MONTHS').split(',');for(var M,S=function _loop2(k){if(L.includes(T[k]))return{v:L.replace(/(\d+).*?(\d+)/,function(I,O,j){return t(O)+'/'+t((k+1).toString())+'/'+t(j,4)})}},k=0;k<T.length;k++)if(M=S(k),'object'===('undefined'==typeof M?'undefined':_typeof(M)))return M.v;return L.replace(/(\d+).*?(\d+).*?(\d+)/,function(k,I,O,j){return t(I)+'/'+t(O)+'/'+t(j,4)});default:throw new Error('[Lisa] [BUG] Unreferenced catcher "'+v+'"');}},this.format=function(L){return d.escapeHtml(L).replace(/\*(.*?)\*/g,'<strong>$1</strong>').replace(/_(.*?)_/g,'<em>$1</em>').replace(/~(.*?)~/g,'<del>$1</del>').replace(/%([a-zA-Z][a-zA-Z0-9_]*)%/g,function(v,T){if(Lisa.knows(T))return Lisa.thinksTo(T);throw new Error('[Lisa] Variable "'+T+'" is not defined in message "'+L+'"')})},this.makeHandlerRegex=function(L){var v=1<arguments.length&&arguments[1]!==void 0&&arguments[1],T=[],x=new RegExp('^'+L.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,'\\$&').replace(/ /g,' +').replace(/\\\{(.*?)\\\}/g,function(A,S){if(S.startsWith('\\?'))return T.push('?'),S.substr(2).includes('\\|')?':'===S.substr(2,1)?'('+S.substr(3).split('\\|').join('|')+'|)':'('+S.substr(2).split('\\|').join('|')+')':'('+S.substr(2)+'|)';if('\\*'===S&&(S='*'),!RegexCatchers.hasOwnProperty(S))throw new Error('[Lisa] Unknown catcher "'+S+'"');return T.push(S),RegexCatchers[S]()}).replace(/( \+)?\\\.$/,' *(?:[\\.]*)?').replace(/( \+)?\\\?$/,' *(?:[\\?]*)?')+'(?: *[!\\.])*$','i');return v?[x,T]:x},this.when=function(L,v){if(!_.hasOwnProperty(L))throw new Error('[Lisa] Unknown event name');if('function'!=typeof v)throw new Error('[Lisa] Illegal callback provided, must be a function');_[L]=v},this.understands=function(L,v){var T=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},x=arguments[3];if(g.includes(L))throw new Error('[Lisa] Handler is already in use');if('string'==typeof v)v=new Function([],Reflect.ownKeys(T).map(function(j){return'Lisa.learns("'+j+'","'+T[j].replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function($,U){return'"+arguments[0].formatted['+U+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function($,U){return'"+arguments[0].caught['+U+']+"'})+'");'})+'return "'+v.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function(j,$){return'"+arguments[0].formatted['+$+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function(j,$){return'"+arguments[0].caught['+$+']+"'})+'"');else if('function'!=typeof v)throw new Error('[Lisa] Illegal handler\'s callback provided');else if(T){var j=v;v=new Function(['requested'],'('+function($){var U=!0,P=!1,E=void 0;try{for(var N,H,C=Reflect.ownKeys($)[Symbol.iterator]();!(U=(N=C.next()).done);U=!0)H=N.value,Lisa.learns(H,$[H].replace(/\$\^(\d|[1-9]\d+)/g,function(R,F){return requested.formatted[F]}).replace(/\$_(\d|[1-9]\d+)/g,function(R,F){return requested.caught[F]}))}catch(H){P=!0,E=H}finally{try{!U&&C.return&&C.return()}finally{if(P)throw E}}}.toString()+')('+JSON.stringify(T)+');return ('+j.toString()+')(requested);')}var A=d.makeHandlerRegex(L,!0);if(x){if(!Array.isArray(x))throw new Error('[Lisa] Illegal help text argument provided');if(x.length!==A[1].length)throw new Error('[Lisa] Insufficient help for parameters in handler "'+L+'"');var S=!0,M=!1,k=void 0;try{for(var O,j,I=x[Symbol.iterator]();!(S=(O=I.next()).done);S=!0)if(j=O.value,!['string','function'].includes('undefined'==typeof j?'undefined':_typeof(j)))throw new Error('[Lisa] Illegal help text given for handler "'+L+'"')}catch(j){M=!0,k=j}finally{try{!S&&I.return&&I.return()}finally{if(M)throw k}}}return y.push([A[0],A[1],v,x||null]),g.push(L),_.understood&&_.understood(new RegExp(A[0].toString().slice(1,-2)),A[1].slice(0),v,x?x.slice(0):null),A[0]},this.displayMessage=function(L,v,T){var x=document.createElement('div');x.setAttribute('class','message message-'+T),x.innerHTML='<strong>'+L+' : </strong>'+d.format(v),l.appendChild(x);var A=l.scrollHeight-l.scrollTop,S=setInterval(function(){return l.scrollTop++},Math.floor(2e3/A));setTimeout(function(){return clearInterval(S)},2e3),h&&u.push([Date.now(),L,v,T]),_.message&&_.message(Date.now(),L,v,T)},this.helpsAbout=function(L){var v=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(!g.includes(L))throw new Error('[Lisa] Unknown handler "'+L+'"');var T=y[g.indexOf(L)][3];if(!T)return!1;if(v)return T.slice(0);var x=0;return L.replace(/\{(.*?)\}/g,function(){return'['+T[x++]+']'})},this.learns=function(L,v){if('string'!=typeof L||!L.length||{}[L]||'$'===L)throw new Error('[Lisa] Illegal name provided for memory\'s cell');if(!['string','number','boolean'].includes('undefined'==typeof v?'undefined':_typeof(v)))throw new Error('[Lisa] Illegal value provided for memory\'s cell "'+L+'"');m[L]=v,_.learnt&&_.learnt(L,v)},this.learnsList=function(L,v,T){if('string'!=typeof L||!L.length||{}[L]||'$'===L)throw new Error('[Lisa] Illegal name provided for memory\'s cell');if(!['integer','floating','string'].includes(T))throw new Error('[Lisa] Unknown type "'+T+'", must be "integer", "floating" or "string"');if(!Array.isArray(v))throw new Error('[Lisa] Illegal list provided, must be an array');v=v.slice(0);for(var x=0;x<v.length;x++)if(!r(v[x],T))throw new Error('[Lisa] Value at index '+x+' is not a '+T);m[L]=v,m.$[L]=T,_.learnt&&_.learnt(L,v.slice(0))},this.learnsIntList=function(L,v){return d.learnsList(L,v,'integer')},this.learnsFloatList=function(L,v){return d.learnsList(L,v,'floating')},this.learnsStrList=function(L,v){return d.learnsList(L,v,'string')},this.thinksToList=function(L){return m.$.hasOwnProperty(L)?m[L].slice(0):void 0},this.thinksToListValue=function(L,v){return m.$.hasOwnProperty(L)&&m[L].length>v?m[L][v]:void 0},this.thinksToListType=function(L){return m.$.hasOwnProperty(L)?m.$[L]:void 0},this.learnsListValue=function(L,v){if(!m.$.hasOwnProperty(L))throw new Error('[Lisa] Unknown list "'+L+'"');if(!r(v,m.$[L]))throw new Error('[Lisa] Provided value for list "'+L+'" is not an '+m.$[L]);m[L].push(v),_.learnt&&_.learnt(L,v,m[L].length-1)},this.knows=function(L){return'$'!==L&&m.hasOwnProperty(L)},this.thinksTo=function(L){return m.hasOwnProperty(L)&&'$'!==L?Array.isArray(m[L])?m[L].join(';'):m[L]:void 0},this.forgets=function(L){if(!m.hasOwnProperty(L)||'$'===L)throw new Error('[Lisa] Can\'t forget unexisting cell');var v=m[L];return delete m[L],delete m.$[L],_.forgot&&_.forgot(L,v),v},this.says=function(L){return d.displayMessage('Lisa',L,'lisa')},this.hears=function(L){return d.displayMessage('You',L,'user')},this.does=function(L){var v=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,T=L;L=L.trim();var x,A=!0,S=!1,M=void 0;try{for(var I,O,k=y[Symbol.iterator]();!(A=(I=k.next()).done);A=!0)if(O=I.value,x=L.match(O[0])){for(var j={request:L,requestWithSpaces:T,caught:x.slice(1),formatted:[],handlerRegex:O[0],catchers:O[1],callback:O[2],help:O[3],handler:g[y.indexOf(O)],display:!!v},P=0;P<O[1].length;P++)j.formatted.push(d.getStandard(x[P+1],O[1][P]));var $=O[2].call(d,j),U=!1;return'number'==typeof $?$=U.toString():$&&$ instanceof HTMLElement?($=U.innerHTML,U=!0):'string'!=typeof $&&!1!==$&&($='Sorry, I encountered a problem. Please try again.'),v&&!1!==$&&d.says($,U),h&&!1!==$&&p.push([Date.now(),j.requestWithSpaces,j.handler,j.caught.slice(0),j.display]),_.did&&_.did(p.slice(-1)[0],JSON.parse(JSON.stringify(j)),$),$}}catch(O){S=!0,M=O}finally{try{!A&&k.return&&k.return()}finally{if(S)throw M}}d.says('I didn\'t understand your request.',!0)},this.nowRemembersMessages=function(){h=!0},this.doesntRememberMessages=function(){h=!1},this.getMessage=function(){var L=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if('number'!=typeof L||Math.floor(L)!==L)throw new Error('[Lisa] Invalid ID given while getting message');if(0>L&&(L=-L),u.length<=L)throw new Error('[Lisa] There is no message with id "'+L+'"');return u.slice(0)},this.export=function(){var L=[],v=!0,T=!1,x=void 0;try{for(var S,M,A=y[Symbol.iterator]();!(v=(S=A.next()).done);v=!0)M=S.value,L.push([M[0].toString(),M[1],M[2].toString(),M[3]])}catch(M){T=!0,x=M}finally{try{!v&&A.return&&A.return()}finally{if(T)throw x}}return JSON.stringify({memory:m,handled:g,handlers:L,rememberMessages:h,messages:u,requests:p})},this.learns('HOURS_NAME','hours'),this.learns('MINUTES_NAME','minutes'),this.learns('SECONDS_NAME','secondes'),this.learns('MONTHS','january,february,march,april,may,june,july,august,september,october,november,december'),this.__defineGetter__('dom',function(){return l}),this.__defineGetter__('memory',function(){return JSON.parse(JSON.stringify(m))}),this.__defineGetter__('messages',function(){return JSON.parse(JSON.stringify(u))}),this.__defineGetter__('history',function(){return JSON.parse(JSON.stringify(p))}),this.__defineGetter__('remembersMessages',function(){return h}),this.__defineSetter__('remembersMessages',function(L){return L?d.nowRemembersMessages():d.doesntRememberMessages()})},LZString=function(){function t(h,m){if(!u[h]){u[h]={};for(var g=0;g<h.length;g++)u[h][h.charAt(g)]=g}return u[h][m]}var r=String.fromCharCode,d='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',l='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$',u={},p={compressToBase64:function compressToBase64(h){if(null==h)return'';var m=p._compress(h,6,function(g){return d.charAt(g)});switch(m.length%4){default:case 0:return m;case 1:return m+'===';case 2:return m+'==';case 3:return m+'=';}},decompressFromBase64:function decompressFromBase64(h){return null==h?'':''==h?null:p._decompress(h.length,32,function(m){return t(d,h.charAt(m))})},compressToUTF16:function compressToUTF16(h){return null==h?'':p._compress(h,15,function(m){return r(m+32)})+' '},decompressFromUTF16:function decompressFromUTF16(h){return null==h?'':''==h?null:p._decompress(h.length,16384,function(m){return h.charCodeAt(m)-32})},compressToUint8Array:function compressToUint8Array(h){for(var L,m=p.compress(h),g=new Uint8Array(2*m.length),y=0,_=m.length;y<_;y++)L=m.charCodeAt(y),g[2*y]=L>>>8,g[2*y+1]=L%256;return g},decompressFromUint8Array:function decompressFromUint8Array(h){if(null===h||h===void 0)return p.decompress(h);var m=function(){for(var g=Array(h.length/2),_=0,L=g.length;_<L;_++)g[_]=256*h[2*_]+h[2*_+1];var y=[];return g.forEach(function(_){y.push(r(_))}),{v:p.decompress(y.join(''))}}();if('object'===('undefined'==typeof m?'undefined':_typeof(m)))return m.v},compressToEncodedURIComponent:function compressToEncodedURIComponent(h){return null==h?'':p._compress(h,6,function(m){return l.charAt(m)})},decompressFromEncodedURIComponent:function decompressFromEncodedURIComponent(h){return null==h?'':''==h?null:(h=h.replace(/ /g,'+'),p._decompress(h.length,32,function(m){return t(l,h.charAt(m))}))},compress:function compress(h){return p._compress(h,16,function(m){return r(m)})},_compress:function _compress(h,m,g){if(null==h)return'';var y=void 0,_,L={},v={},T='',x='',A='',S=2,M=3,k=2,I=[],O=0,j=0,$;for($=0;$<h.length;$+=1)if(T=h.charAt($),Object.prototype.hasOwnProperty.call(L,T)||(L[T]=M++,v[T]=!0),x=A+T,Object.prototype.hasOwnProperty.call(L,x))A=x;else{if(Object.prototype.hasOwnProperty.call(v,A)){if(256>A.charCodeAt(0)){for(y=0;y<k;y++)O<<=1,j==m-1?(j=0,I.push(g(O)),O=0):j++;for(_=A.charCodeAt(0),y=0;8>y;y++)O=O<<1|1&_,j==m-1?(j=0,I.push(g(O)),O=0):j++,_>>=1}else{for(_=1,y=0;y<k;y++)O=O<<1|_,j==m-1?(j=0,I.push(g(O)),O=0):j++,_=0;for(_=A.charCodeAt(0),y=0;16>y;y++)O=O<<1|1&_,j==m-1?(j=0,I.push(g(O)),O=0):j++,_>>=1}S--,0==S&&(S=Math.pow(2,k),k++),delete v[A]}else for(_=L[A],y=0;y<k;y++)O=O<<1|1&_,j==m-1?(j=0,I.push(g(O)),O=0):j++,_>>=1;S--,0==S&&(S=Math.pow(2,k),k++),L[x]=M++,A=T+''}if(''!==A){if(Object.prototype.hasOwnProperty.call(v,A)){if(256>A.charCodeAt(0)){for(y=0;y<k;y++)O<<=1,j==m-1?(j=0,I.push(g(O)),O=0):j++;for(_=A.charCodeAt(0),y=0;8>y;y++)O=O<<1|1&_,j==m-1?(j=0,I.push(g(O)),O=0):j++,_>>=1}else{for(_=1,y=0;y<k;y++)O=O<<1|_,j==m-1?(j=0,I.push(g(O)),O=0):j++,_=0;for(_=A.charCodeAt(0),y=0;16>y;y++)O=O<<1|1&_,j==m-1?(j=0,I.push(g(O)),O=0):j++,_>>=1}S--,0==S&&(S=Math.pow(2,k),k++),delete v[A]}else for(_=L[A],y=0;y<k;y++)O=O<<1|1&_,j==m-1?(j=0,I.push(g(O)),O=0):j++,_>>=1;S--,0==S&&(S=Math.pow(2,k),k++)}for(_=2,y=0;y<k;y++)O=O<<1|1&_,j==m-1?(j=0,I.push(g(O)),O=0):j++,_>>=1;for(;;)if(O<<=1,j==m-1){I.push(g(O));break}else j++;return I.join('')},decompress:function decompress(h){return null==h?'':''==h?null:p._decompress(h.length,32768,function(m){return h.charCodeAt(m)})},_decompress:function _decompress(h,m,g){var y=[],_,L=4,v=4,T=3,x='',A=[],S,M,k,I,O,j,$,U={val:g(0),position:m,index:1};for(S=0;3>S;S+=1)y[S]=S;for(k=0,O=Math.pow(2,2),j=1;j!=O;)I=U.val&U.position,U.position>>=1,0==U.position&&(U.position=m,U.val=g(U.index++)),k|=(0<I?1:0)*j,j<<=1;switch(_=k){case 0:for(k=0,O=Math.pow(2,8),j=1;j!=O;)I=U.val&U.position,U.position>>=1,0==U.position&&(U.position=m,U.val=g(U.index++)),k|=(0<I?1:0)*j,j<<=1;$=r(k);break;case 1:for(k=0,O=Math.pow(2,16),j=1;j!=O;)I=U.val&U.position,U.position>>=1,0==U.position&&(U.position=m,U.val=g(U.index++)),k|=(0<I?1:0)*j,j<<=1;$=r(k);break;case 2:return'';}for(y[3]=$,M=$,A.push($);;){if(U.index>h)return'';for(k=0,O=Math.pow(2,T),j=1;j!=O;)I=U.val&U.position,U.position>>=1,0==U.position&&(U.position=m,U.val=g(U.index++)),k|=(0<I?1:0)*j,j<<=1;switch($=k){case 0:for(k=0,O=Math.pow(2,8),j=1;j!=O;)I=U.val&U.position,U.position>>=1,0==U.position&&(U.position=m,U.val=g(U.index++)),k|=(0<I?1:0)*j,j<<=1;y[v++]=r(k),$=v-1,L--;break;case 1:for(k=0,O=Math.pow(2,16),j=1;j!=O;)I=U.val&U.position,U.position>>=1,0==U.position&&(U.position=m,U.val=g(U.index++)),k|=(0<I?1:0)*j,j<<=1;y[v++]=r(k),$=v-1,L--;break;case 2:return A.join('');}if(0==L&&(L=Math.pow(2,T),T++),y[$])x=y[$];else if($===v)x=M+M.charAt(0);else return null;A.push(x),y[v++]=M+x.charAt(0),L--,M=x,0==L&&(L=Math.pow(2,T),T++)}}};return p}();Lisa.dom.setAttribute('id','discuss'),document.body.appendChild(Lisa.dom);var input=document.createElement('input');input.setAttribute('id','input'),input.addEventListener('keydown',function(t){if(13===t.keyCode){if(!input.value.length)return;var r=input.value;input.value='',Lisa.hears(r),Lisa.does(r)}}),document.body.appendChild(input);function loadState(t){if('object'!==('undefined'==typeof t?'undefined':_typeof(t))||!t||Array.isArray(t))throw new Error('[Lisa:load] State to load must be an object');if(!Array.isArray(t.handlers)||'object'!==_typeof(t.memory)||!t.memory||Array.isArray(t.memory)||!Array.isArray(t.messages)||'boolean'!=typeof t.histories)throw new Error('[Lisa:load] Fields are missing or corrupted in the state object');var r=!0,d=!1,l=void 0;try{for(var p,u=t.handlers[Symbol.iterator]();!(r=(p=u.next()).done);r=!0){var S=p.value,M=S[1].match(/^function.*?\((?:(?: |\n)*)([a-zA-Z][a-zA-Z0-9_]*|)(?:\n\/\*\*\/|)(?:(?: |\n)*)\)(?:(?: |\n)*)\{((?:.|\n)*)\}$/);Lisa.understands(S[0],new Function([M[1]],M[2]),null,S[2])}}catch(S){d=!0,l=S}finally{try{!r&&u.return&&u.return()}finally{if(d)throw l}}var h=!0,m=!1,g=void 0;try{for(var _,S,y=Reflect.ownKeys(t.memory)[Symbol.iterator]();!(h=(_=y.next()).done);h=!0)S=_.value,'$'===S||(t.memory.$.hasOwnProperty(S)?Lisa.learnsList(S,t.memory[S],t.memory.$[S]):Lisa.learns(S,t.memory[S]))}catch(S){m=!0,g=S}finally{try{!h&&y.return&&y.return()}finally{if(m)throw g}}Lisa.remembersMessages=!0;var L=!0,v=!1,T=void 0;try{for(var A,S,x=t.messages[Symbol.iterator]();!(L=(A=x.next()).done);L=!0)S=A.value,Lisa.displayMessage(S[1],S[2],S[3])}catch(S){v=!0,T=S}finally{try{!L&&x.return&&x.return()}finally{if(v)throw T}}Lisa.rememberMessages=t.histories}function saveState(){for(var t=JSON.parse(Lisa.export()),r={handlers:[],memory:t.memory,messages:t.messages},d=0;d<t.handlers.length;d++)r.handlers.push([t.handled[d],t.handlers[d][2],t.handlers[d][3]]);r.histories=Lisa.remembersMessages,r=JSON.stringify(r),t=null,r<102400?localStorage.setItem('lisa_state','P'+r):localStorage.setItem('lisa_state','L'+reverse(LZString.compressToUTF16(reverse(r))))}function reverse(t){for(var r='',d=t.length-1;0<=d;d--)r+=t[d];return r}var data=localStorage.getItem('lisa_state');if(data){var t=function corrupted(){'object'===('undefined'==typeof console?'undefined':_typeof(console))&&'function'==typeof console.error&&console.error('Corrupted data found in localStorage'),('object'===('undefined'==typeof window?'undefined':_typeof(window))?window:'object'===('undefined'==typeof global?'undefined':_typeof(global))?global:'object'===_typeof(this)?this:{}).corrupted_local_lisa_state=data,localStorage.removeItem('lisa_state'),data=null};if(data.startsWith('L')?data=reverse(LZString.decompressFromUTF16(reverse(data.substr(1)))):data.startsWith('P')?data=reverse(data.substr(1)):t(),data){try{data=JSON.parse(data)}catch(r){t()}data&&loadState(data)}}Lisa.when('message',saveState),Lisa.when('did',saveState),Lisa.when('learnt',saveState),Lisa.when('forgot',saveState),Lisa.when('understood',saveState);function getXMLHttpRequest(){if(window.ActiveXObject)try{return new ActiveXObject('Msxml2.XMLHTTP')}catch(t){return new ActiveXObject('Microsoft.XMLHTTP')}else return new XMLHttpRequest}var LisaInterface={comparators:{'=':'===','==':'===',is:'===','!':'!==','!=':'!==','!==':'!==','is not':'!==',isnt:'!=='},compile:function compile(t){function r(M){throw new Error('[LIS:compile] At line '+y+' :\n'+_+'\n^\n'+M)}function d(M){return M.startsWith('_')?'_a.caught['+M.substr(1)+']':M.startsWith('^')?'_a.formatted['+M.substr(1)+']':M.match(/^([a-zA-Z][a-zA-Z0-9_]*)$/)?'Lisa.thinksTo("'+M+'")':M}function l(){for(var M=0;M<h-m;M++)L.includes(h-M-1)?(p+='return false;});',L.splice(L.indexOf(h-M-1),1)):p+='}';h=m}if('string'!=typeof t)throw new Error('[LIS:compile] Invalid source code provided, must be a string');var m,g,u=t.split(/\r\n|\r|\n/g),p='',h=0,y=0,_=void 0,L=[],v=!0,T=!1,x=void 0;try{for(var S,A=u[Symbol.iterator]();!(v=(S=A.next()).done);v=!0)_=S.value,y++,m=_.match(/^(  |\t)*/)[0].replace(/  /g,'\t').length,_=_.trim(),_&&(h&&(m>h?r('Wrong indentation, expecting '+h+' tab'+(1<h?'s':'')+' but '+m+' given.'):m<h&&l()),!h&&m&&r('Wrong indentation, expecting no tab'),(g=_.match(/^else +/))&&(p+='else ',_=_.substr(g[0].length)),'else'===_?(p+='else{',h++):(g=_.match(/^if( +NOT *|) +([a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+)$/))?(p+='if('+(g[1]?'!':'')+d(g[2])+'){',h++):(g=_.match(/^if( +NOT *|) +knows +([a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+)$/))?(p+='if('+(g[1]?'!':'')+'Lisa.knows("'+g[2]+'")){',h++):(g=_.match(/^if +([a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+) *(<=|>=|<|>) *(\d+[.]?|\d*\.\d+)$/))?(p+='if(Lisa.thinksTo("'+g[1]+'")'+g[2]+g[3]+'){',h++):(g=_.match(/^if +("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+) *(=|==|\!|\!=|\!==|is not|isnt|is) *("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+)$/))?(p+='if('+d(g[1])+this.comparators[g[2]]+d(g[3])+'){',h++):(g=_.match(/^say +"(.*)"$/))?p+='Lisa.says("'+g[1].replace(/%_(\d|[1-9]\d*)%/g,'"+_a.caught[$1]+"').replace(/%\^(\d|[1-9]\d*)%/g,'"+_a.formatted[$1]+"')+'");':(g=_.match(/^(end|return|die|output) +("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+)$/))?p+='return '+d(g[2])+';':(g=_.match(/^(store|set|learn|rem|remember|mem|memorize|save)[s]? +("(?:.*)"|\d+[.]?|\d*\.\d+|[a-zA-Z][a-zA-Z0-9_]*|_\d+|\^\d+) *=> *([a-zA-Z][a-zA-Z0-9_]*)$/))?p+='Lisa.learns("'+g[3]+'",'+d(g[2])+');':(g=_.match(/^"(.*)" *=>$/))?(p+='Lisa.understands("'+g[1]+'",function(){var _a=arguments[0];',L.push(h),h++):(g=_.match(/^(unstore|unset|unlearn|unremember|unmemorize|unsave|forget)[s]? +([a-zA-Z][a-zA-Z0-9_]*)$/))?p+='Lisa.forgets("'+g[2]+'");':r('Syntax error'))}catch(M){T=!0,x=M}finally{try{!v&&A.return&&A.return()}finally{if(T)throw x}}return m=0,l(),p},exec:function exec(t){new Function([],this.compile(t))()},download:function download(t){var r=this,d=void 0;if('string'!=typeof t||!t)throw new Error('[LIS:download] Illegal URL provided, must be a not-empty string');if(t.startsWith('file://'))throw new Error('[LIS:download] Protocol "file:///" is forbidden: Lisa is not allowed to load local computer\'s resources');(d=t.match(/^presets?:\/\/\/?((?:[a-zA-Z_0-9][\/\\]?)+)(\.lis|)$/))&&(t=location.href.split('/').slice(0,-1).join('/')+'/presets/'+d[1].split('\\').join('/')+'.lis');var l=getXMLHttpRequest();l.open('GET',t,!0),l.addEventListener('readystatechange',function(){if(4===l.readyState)if(200===l.status)r.exec(l.responseText);else throw new Error('[LIS:download] Failed to download the LIS program (status code: '+l.status+')')}),l.send(null)}};
