"use strict";function getXMLHttpRequest(){if(!window.ActiveXObject)return new XMLHttpRequest;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){return new ActiveXObject("Microsoft.XMLHTTP")}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Lisa=new(function(){var e=function(){function e(e){return"("+s[e]()+")"}function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"0".repeat(t-e.length)+e}function r(e,t){switch(t){case"boolean":return e===!1||e===!0;case"integer":return!("number"!=typeof e||Math.floor(e)!==e||e<0);case"floating":return"number"==typeof e;case"string":return"string"==typeof e}}function n(e){return e.startsWith("_")&&e.endsWith("_")?" "+e.slice(1,-1)+" ":e.startsWith("_")?" "+e.slice(1):e.endsWith("_")?e.slice(0,-1)+" ":e}var i=this,s={"*":function(){return".+?"},digit:function(){return"\\d"},number:function(){return"\\d+[.]?|\\d*\\.\\d+"},unsigned_number:function(){return"[-]?"+s.number()},integer:function(){return"\\d+"},unsigned_integer:function(){return"[-]?"+s.integer()},letter:function(){return"[a-zA-Z]"},alphanum:function(){return"[a-zA-Z0-9]"},short_time:function(){return"(?:[01]?\\d|2[0-3])(?: *: *| +"+i.thinksTo("HOURS_NAME")+" +)[0-5]\\d(?:| +"+i.thinksTo("MINUTES_NAME")+")"},time:function(){return"(?:[01]?\\d|2[0-3])(?: *: *| +"+i.thinksTo("HOURS_NAME")+" +)[0-5]\\d(?: *: *| +"+i.thinksTo("MINUTES_NAME")+" +)[0-5]\\d))(?:|"+i.thinksTo("SECONDS_NAME")},short_date:function(){return"(?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *| +(?:"+i.thinksTo("MONTHS").split(",").join("|")+"))"},date:function(){return"(?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *[\\/\\-\\.] *| +(?:"+i.thinksTo("MONTHS").split(",").join("|")+") +)\\d{4}"},email:function(){return'(?:(?:[^<>\\(\\)\\[\\]\\.,;:\\s@\\"]+(?:\\.[^<>()\\[\\]\\.,;:\\s@\\"]+)*)|(?:\\".+\\"))@(?:(?:[^<>()[\\]\\.,;:\\s@\\"]+\\.)+[^<>\\(\\)[\\]\\.,;:\\s@\\"]{2,})'},url:function(){return"(?:https?:\\/\\/|)(?:www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,6}\\b[-a-zA-Z0-9@:%_\\+.~#?&//=]*(?:#.*|)"}},a=Reflect.ownKeys(s),o={},l="en";o[l]=[];var u=[],c=[],f=!0,d={$:{}},h=[],p=[],g={message:null,did:null,learnt:null,forgot:null,understood:null};this.escapeHtml=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},this.getStandard=function(e,r){if(!s.hasOwnProperty(r)&&"?"!==r&&"#"!==r)throw new Error('[Lisa] Unknown catcher "'+r+'"');var n=void 0;switch(r){case"short_time":return e.replace(/^([0-9]+).*([0-9]+)$/,function(e,r,n){return t(r)+":"+t(n)});case"time":return e.replace(/^([0-9]+).*([0-9]+).*([0-9]+)$/,t($1)+":"+t($2)+":"+t($3));case"short_date":n=i.thinksTo("MONTHS").split(",");for(var a=0;a<n.length;a++)if(e.includes(n[a]))return t(e.match(/\d+/)[0])+"/"+t((a+1).toString());return e.replace(/(\d+).*?(\d+)/,function(e,r,n){return t(r)+"/"+t(n)});case"date":n=i.thinksTo("MONTHS").split(",");for(var o=function(r){if(e.includes(n[r]))return{v:e.replace(/(\d+).*?(\d+)/,function(e,n,i){return t(n)+"/"+t((r+1).toString())+"/"+t(i,4)})}},l=0;l<n.length;l++){var u=o(l);if("object"===("undefined"==typeof u?"undefined":_typeof(u)))return u.v}return e.replace(/(\d+).*?(\d+).*?(\d+)/,function(e,r,n,i){return t(r)+"/"+t(n)+"/"+t(i,4)});default:return e}},this.format=function(e){return i.escapeHtml(e).replace(/\*(.*?)\*/g,"<strong>$1</strong>").replace(/_(.*?)_/g,"<em>$1</em>").replace(/~(.*?)~/g,"<del>$1</del>").replace(/%([a-zA-Z][a-zA-Z0-9_]*)%/g,function(t,r){if(i.knows(r))return i.thinksTo(r);throw new Error('[Lisa] Variable "'+r+'" is not defined in message "'+e+'"')})},this.makeHandlerRegex=function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l,u=[];if(!o.hasOwnProperty(a))throw new Error("[Lisa] Unknown locale provided");var c=new RegExp("^"+i.translatesLocaleText(t,a).replace(/ /g," +").replace(/\\\{(.*?)\\\}/g,function(t,r){if(r.startsWith("\\?"))return u.push("?"),r.substr(2).includes("\\|")?":"===r.substr(2,1)?"("+r.substr(3).split("\\|").join("|")+"|)":"("+r.substr(2).split("\\|").join("|")+")":"("+r.substr(2)+"|)";if(r.startsWith("#"))return u.push("#"),"("+r.substr(1).replace(/\\([\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|])/g,"$1")+")";if("\\*"===r)return u.push("*"),e("*");if(!s.hasOwnProperty(r))throw new Error('[Lisa] Unknown catcher "'+r+'"');return n?"(.*?)":(u.push(r),e(r))}).replace(/( \+)?\\\.$/," *(?:[\\.]*)?").replace(/( \+)?\\\?$/," *(?:[\\?]*)?")+"(?: *[!\\.])*$","i");return r?[c,u,i.makeHandlerRegex(t,!1,!0)]:c},this.when=function(e,t){if(!g.hasOwnProperty(e))throw new Error("[Lisa] Unknown event name");if("function"!=typeof t)throw new Error("[Lisa] Illegal callback provided, must be a function");g[e]=t},this.understands=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3];if(h.includes(e))throw new Error("[Lisa] Handler is already in use");if("string"==typeof t)t=new Function([],Reflect.ownKeys(r).map(function(e){return'Lisa.learns("'+e+'","'+r[e].replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function(e,t){return'"+arguments[0].formatted['+t+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function(e,t){return'"+arguments[0].caught['+t+']+"'})+'");'})+'return "'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function(e,t){return'"+arguments[0].formatted['+t+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function(e,t){return'"+arguments[0].caught['+t+']+"'})+'"');else{if("function"!=typeof t)throw new Error("[Lisa] Illegal handler's callback provided");if(r&&Reflect.ownKeys(r).length){var s=t;t=new Function(["requested"],"var ret=("+s.toString()+")(requested);("+function(e,t){var r=!0,n=!1,i=void 0;try{for(var s,a=Reflect.ownKeys(e)[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var o=s.value;t.learns(o,e[o].replace(/%\^(\d|[1-9]\d+)%/g,function(e,t){return requested.formatted[t]}).replace(/%_(\d|[1-9]\d+)%/g,function(e,t){return requested.caught[t]}))}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}}.toString()+")("+JSON.stringify(r)+", requested.caller);return ret;")}}var a=i.makeHandlerRegex(e,!0);if(n){if(!Array.isArray(n))throw new Error("[Lisa] Illegal help text argument provided");if(n.length!==a[1].length)throw new Error('[Lisa] Insufficient help for parameters in handler "'+e+'"');var o=!0,l=!1,u=void 0;try{for(var c,f=n[Symbol.iterator]();!(o=(c=f.next()).done);o=!0){var d=c.value;if(!["string","function"].includes("undefined"==typeof d?"undefined":_typeof(d)))throw new Error('[Lisa] Illegal help text given for handler "'+e+'"')}}catch(e){l=!0,u=e}finally{try{!o&&f.return&&f.return()}finally{if(l)throw u}}}return p.push([a[0],a[1],a[2],t,n||null]),h.push(e),g.understood&&g.understood(new RegExp(a[0].toString().slice(1,-2)),a[1].slice(0),a[2].toString().slice(1,-2),t,n?n.slice(0):null),a[0]},this.displayMessage=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t=void 0===t||null===t||"function"!=typeof t.toString?"":t.toString(),n||(t=i.format(t)),f&&u.push([Date.now(),e,t,r,!!n]),g.message&&g.message(Date.now(),e,t,r,!!n)},this.helpsAbout=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!h.includes(e))throw new Error('[Lisa] Unknown handler "'+e+'"');var r=p[h.indexOf(e)][4];if(!r)return!1;if(t)return r.slice(0);var n=0;return e.replace(/\{(.*?)\}/g,function(e){return"["+r[n++]+"]"})},this.registersCatcher=function(e,t){if("string"!=typeof e||!e||{}[e]||!/^[a-z_][a-z0-9_#\*\?\!\+\-\/\\]*$/.test(e))throw new Error("[Lisa] Illegal catcher's name provided");if("string"!=typeof t||!t)throw new Error("[Lisa] Invalid catcher's regex provided, must be a not-empty string");if(s.hasOwnProperty(e))throw new Error('[Lisa] Catcher "'+e+'" is already registered');s[e]=function(){return t}},this.hasRegistered=function(e){return s.hasOwnProperty(e)},this.thinksToRegisteredCatchers=function(){return Reflect.ownKeys(s)},this.thinksToCatcher=function(t){return s.hasOwnProperty(t)?e(t):void 0},this.learns=function(e,t){if("string"!=typeof e||!e.length||{}[e]||"$"===e)throw new Error("[Lisa] Illegal name provided for memory's cell");if(!["string","number","boolean"].includes("undefined"==typeof t?"undefined":_typeof(t)))throw new Error("[Lisa] Illegal value provided for memory's cell \""+e+'"');d.$.hasOwnProperty(e)&&delete d.$[e],d[e]=t,g.learnt&&g.learnt(e,t)},this.learnsList=function(e,t,n){if("string"!=typeof e||!e.length||{}[e]||"$"===e)throw new Error("[Lisa] Illegal name provided for memory's cell");if(n={bool:"boolean",int:"integer",float:"floating",str:"string"}[n]||n,!["boolean","integer","floating","string"].includes(n))throw new Error('[Lisa] Unknown type "'+n+'", must be "boolean", "integer", "floating" or "string"');if(!Array.isArray(t))throw new Error("[Lisa] Illegal list provided, must be an array");t=t.slice(0);for(var i=0;i<t.length;i++)if(!r(t[i],n))throw new Error("[Lisa] Value at index "+i+" is not a "+n);d[e]=t,d.$[e]=n,g.learnt&&g.learnt(e,t.slice(0))},this.learnsBoolList=function(e,t){return i.learnsList(e,t,"boolean")},this.learnsIntList=function(e,t){return i.learnsList(e,t,"integer")},this.learnsFloatList=function(e,t){return i.learnsList(e,t,"floating")},this.learnsStrList=function(e,t){return i.learnsList(e,t,"string")},this.thinksToList=function(e){return d.$.hasOwnProperty(e)?d[e].slice(0):void 0},this.thinksToListValue=function(e,t){return d.$.hasOwnProperty(e)&&d[e].length>t?d[e][t]:void 0},this.thinksToListLastValue=function(e){return d.$.hasOwnProperty(e)?d[e].slice(-1)[0]:void 0},this.thinksToListType=function(e){return d.$.hasOwnProperty(e)?d.$[e]:void 0},this.learnsListValue=function(e,t,n){if(!d.$.hasOwnProperty(e))throw new Error('[Lisa] Unknown list "'+e+'"');if(!r(t,d.$[e]))throw new Error('[Lisa] Provided value for list "'+e+'" is not an '+d.$[e]);if("undefined"!=typeof n){if("number"!=typeof n||n<0||Math.floor(n)!==n)throw new Error("[Lisa] List's index must be a positive integer");if(n===d[e].length)d[e].push(t);else{if(n>d[e].length)throw new Error("[Lisa] Length mismatch: List contains "+d[e].length+" values, can't push a value as the "+n+" index.");d[e][n]=t}}else d[e].push(t);g.learnt&&g.learnt(e,t,"undefined"==typeof n?d[e].length-1:n)},this.sortsList=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!d.$.hasOwnProperty(e))throw new Error('[Lisa] List "'+e+'" was not found');var n=(t?d[e]:d[e].slice(0)).sort(["integer","floating"].includes(d.$[e])?function(e,t){return e-t}:null);return r||(n=n.reverse()),t&&g.learnt&&g.learnt(e,list.slice(0)),t?n.slice(0):n},this.shufflesList=function(e,t){if(!d.$.hasOwnProperty(e))throw new Error('[Lisa] List "'+e+'" was not found');for(var r=t?d[e]:d[e].slice(0),n=r.length,i=void 0,s=void 0;n;)s=Math.floor(Math.random()*n),n--,i=r[n],r[n]=r[s],r[s]=i;return t&&g.learnt&&g.learnt(e,r.slice(0)),t?r.slice(0):r},this.reversesList=function(e,t){if(!d.$.hasOwnProperty(e))throw new Error('[Lisa] List "'+e+'" was not found');var r=(t?d[e]:d[e].slice(0)).reverse();return t&&g.learnt&&g.learnt(e,r.slice(0)),t?r.slice(0):r},this.knows=function(e){return"$"!==e&&d.hasOwnProperty(e)},this.knowsValue=function(e){return Object.values(d).includes(e)},this.knowsValueInList=function(e,t){return d.$.hasOwnProperty(e)&&d[e].includes(t)},this.searchesValue=function(e,t){var r=!0,n=!1,i=void 0;try{for(var s,a=Reflect.ownKeys(d)[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var o=s.value;if(d[o]===e)return o;if(d.$[o]){if(!t)continue;if(d[o].includes(e))return o}}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return!1},this.isList=function(e){return d.$.hasOwnProperty(e)},this.thinksTo=function(e){return d.hasOwnProperty(e)&&"$"!==e?Array.isArray(d[e])?d[e].join(";"):d[e]:void 0},this.thinksToCell=function(e){return d.$.hasOwnProperty(e)?d[e].slice(0):d[e]},this.forgets=function(e){if(!d.hasOwnProperty(e)||"$"===e)throw new Error("[Lisa] Can't forget unexisting cell");var t=d[e];return delete d[e],delete d.$[e],g.forgot&&g.forgot(e,t),t},this.thinksToListLength=function(e){return d.$.hasOwnProperty(e)?d[e].length:void 0},this.says=function(e,t){return i.displayMessage("Lisa",e,"lisa",t)},this.hears=function(e,t){return i.displayMessage("You",e,"user",t)},this.does=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e;e=e.trim();var n=void 0,s=!0,a=!1,o=void 0;try{for(var l,u=p[Symbol.iterator]();!(s=(l=u.next()).done);s=!0){var d=l.value;if(d[2].test(e)){if(!(n=e.match(d[0]))){var y=i.thinksTo("REQUEST_SYNTAX_ERROR");return"string"!=typeof y&&(y="A part of your answer is not valid. Please check it."),t&&i.says(y),y}for(var m={request:e,requestWithSpaces:r,caught:n.slice(1),formatted:[],handlerRegex:d[2],handlerStrictRegex:d[0],catchers:d[1],callback:d[3],help:d[4],handler:h[p.indexOf(d)],display:!!t,caller:i},v=0;v<d[1].length;v++)m.formatted.push(i.getStandard(n[v+1],d[1][v]));var w=d[3].call(i,m),L=!1;return"number"==typeof w?w=w.toString():"undefined"!=typeof HTMLElement&&w&&w instanceof HTMLElement?(w=w.innerHTML,L=!0):"string"!=typeof w&&w!==!1&&(w="Sorry, I encountered a problem. Please try again."),t&&w!==!1&&i.says(w,L),f&&w!==!1&&c.push([Date.now(),m.requestWithSpaces,m.handler,m.caught.slice(0),m.display]),g.did&&g.did(c.slice(-1)[0],w),w}}}catch(e){a=!0,o=e}finally{try{!s&&u.return&&u.return()}finally{if(a)throw o}}var b=i.thinksTo("MISUNDERSTOOD_ERROR");return"string"!=typeof b&&(b="I didn't understand your request."),t&&i.says(b),b},this.createsLocaleRegex=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r="",i=!0,s=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){var u=o.value;r+="|"+n(u)}}catch(e){s=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw a}}return r="(?:"+r.substr(1)+")",t?new RegExp(r,"g"):r},this.learnsLocaleTexts=function(e,t){if("string"!=typeof e||2!==e.length)throw new Error("[Lisa] Bad locale given, must be a two-characters long string");if(!Array.isArray(t))throw new Error("[Lisa] Bad locale's replacement texts given, must be an array");if(!t.length)throw new Error('[Lisa] No text was provided for locale "'+e+"\"'s pattern");var r=!0,n=!1,s=void 0;try{for(var a,l=t[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;if("string"!=typeof u||!u)throw new Error('[Lisa] Bad replacement text given for locale "'+e+"\"'s pattern, must be a not-empty string");if(!/^[^\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\!]+$/.test(u))throw new Error("[Lisa] Locales' replacement texts cannot contain RegExp-reserved symbols (while registering pattern for locale \""+e+'")')}}catch(e){n=!0,s=e}finally{try{!r&&l.return&&l.return()}finally{if(n)throw s}}o.hasOwnProperty(e)||(o[e]=[]),o[e].push([i.createsLocaleRegex(t,!0),t.slice(0)])},this.translatesLocaleText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;if("string"!=typeof e||!e)throw new Error("[Lisa] Bad text provided, must be a not-empty string");if(!o.hasOwnProperty(t))throw new Error("[Lisa] Unknown locale provided");e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\!]/g,"\\$&");var r=!0,n=!1,s=void 0;try{for(var a,u=o[t][Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var c=a.value;e=e.replace(c[0],i.createsLocaleRegex(c[1]))}}catch(e){n=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(n)throw s}}return e},this.usesLocale=function(e){if(!o.hasOwnProperty(e))throw new Error("[Lisa] Unknown locale given");l=e},this.knowsTextsIdenticals=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l;if("string"!=typeof e||!e||"string"!=typeof t||!t)throw new Error("[Lisa] Invalid texts given, must be not-empty strings");if(!o.hasOwnProperty(r))throw new Error("[Lisa] Unknown locale given");var n=e.length>t.length?t:e;return new RegExp("^ "+i.translatesLocaleText(n,r)+" $").test(" "+(n===e?t:e)+" ")},this.thinksToLocale=function(){return locale},this.knowsLocale=function(e){return o.hasOwnProperty(e)},this.nowRemembersMessages=function(){return void(f=!0)},this.doesntRememberMessages=function(){return void(f=!1)},this.thinksToMessage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("number"!=typeof e||Math.floor(e)!==e)throw new Error("[Lisa] Invalid ID given while getting message");if(e<0&&(e=-e),u.length<=e)throw new Error('[Lisa] There is no message with id "'+e+'"');return u[u.length-1-e].slice(0)},this.export=function(){var e=[],t=!0,r=!1,n=void 0;try{for(var i,g=p[Symbol.iterator]();!(t=(i=g.next()).done);t=!0){var y=i.value;e.push([y[0].toString(),y[1],y[2].toString(),y[3].toString(),y[4]])}}catch(e){r=!0,n=e}finally{try{!t&&g.return&&g.return()}finally{if(r)throw n}}var m={},v=!0,w=!1,L=void 0;try{for(var b,_=Reflect.ownKeys(s)[Symbol.iterator]();!(v=(b=_.next()).done);v=!0){var S=b.value;a.includes(S)||(m[S]=s[S]())}}catch(e){w=!0,L=e}finally{try{!v&&_.return&&_.return()}finally{if(w)throw L}}var $={},E=!0,T=!1,x=void 0;try{for(var O,k=Reflect.ownKeys(o)[Symbol.iterator]();!(E=(O=k.next()).done);E=!0){var M=O.value;$[M]=[];var z=!0,A=!1,R=void 0;try{for(var I,j=o[M][Symbol.iterator]();!(z=(I=j.next()).done);z=!0){var N=I.value;$[M].push(N[1])}}catch(e){A=!0,R=e}finally{try{!z&&j.return&&j.return()}finally{if(A)throw R}}}}catch(e){T=!0,x=e}finally{try{!E&&k.return&&k.return()}finally{if(T)throw x}}return JSON.stringify({memory:d,handled:h,rememberMessages:f,messages:u,requests:c,currentLocale:l,handlers:e,catchers:m,locales:$})},this.learns("HOURS_NAME","hours"),this.learns("MINUTES_NAME","minutes"),this.learns("SECONDS_NAME","secondes"),this.learns("MONTHS","january,february,march,april,may,june,july,august,september,october,november,december"),this.__defineGetter__("memory",function(){return JSON.parse(JSON.stringify(d))}),this.__defineGetter__("messages",function(){return JSON.parse(JSON.stringify(u))}),this.__defineGetter__("history",function(){return JSON.parse(JSON.stringify(c))}),this.__defineGetter__("remembersMessages",function(){return f}),this.__defineSetter__("remembersMessages",function(e){return e?i.nowRemembersMessages():i.doesntRememberMessages()}),this.__defineSetter__("locale",function(e){return i.usesLocale(e)}),this.__defineGetter__("locale",function(){return l})};return e}());"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module&&!Array.isArray(module)&&(module.exports=Lisa,module.exports.loadParser=function(){eval(require("fs").readFileSync(require("path").join(__dirname,"lis-parser.js"),"utf-8")),delete module.exports.loadParser},module.exports.loadManager=function(){eval(require("fs").readFileSync(require("path").join(__dirname,"localdata.js"),"utf-8")),delete module.exports.loadManager},module.exports.loadUtils=function(){eval(require("fs").readFileSync(require("path").join(__dirname,"utils.js"),"utf-8")),delete module.exports.loadManager}),Lisa.Utils={parseDate:function(e){return Lisa.getStandard(e,"short_date").split("/").map(function(e){return+e})},parseLongDate:function(e){return Lisa.getStandard(e,"date").split("/").map(function(e){return+e})},parseTime:function(e){return Lisa.getStandard(e,"short_time").split("/").map(function(e){return+e})},parseLongTime:function(e){return Lisa.getStandard(e,"time").split("/").map(function(e){return+e})}},Lisa.State={load:function(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e))||!e||Array.isArray(e))throw new Error("[Lisa:load] State to load must be an object");if(!Array.isArray(e.handlers)||"object"!==_typeof(e.memory)||!e.memory||Array.isArray(e.memory)||!Array.isArray(e.messages)||"boolean"!=typeof e.histories)throw new Error("[Lisa:load] Fields are missing or corrupted in the state object");var t=!0,r=!1,n=void 0;try{for(var i,s=Reflect.ownKeys(e.catchers)[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var a=i.value;Lisa.registersCatcher(a,e.catchers[a])}}catch(e){r=!0,n=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw n}}var o=!0,l=!1,u=void 0;try{for(var c,f=Reflect.ownKeys(e.locales)[Symbol.iterator]();!(o=(c=f.next()).done);o=!0){var d=c.value,h=!0,p=!1,g=void 0;try{for(var y,m=e.locales[d][Symbol.iterator]();!(h=(y=m.next()).done);h=!0){var v=y.value;Lisa.learnsLocaleTexts(d,v)}}catch(e){p=!0,g=e}finally{try{!h&&m.return&&m.return()}finally{if(p)throw g}}}}catch(e){l=!0,u=e}finally{try{!o&&f.return&&f.return()}finally{if(l)throw u}}var w=!0,L=!1,b=void 0;try{for(var _,S=e.handlers[Symbol.iterator]();!(w=(_=S.next()).done);w=!0){var $=_.value;Lisa.understands($[0],new Function(["prepare"],"return ("+$[1]+")(prepare);"),null,$[2])}}catch(e){L=!0,b=e}finally{try{!w&&S.return&&S.return()}finally{if(L)throw b}}var E=!0,T=!1,x=void 0;try{for(var O,k=Reflect.ownKeys(e.memory)[Symbol.iterator]();!(E=(O=k.next()).done);E=!0){var M=O.value;"$"!==M&&(e.memory.$.hasOwnProperty(M)?Lisa.learnsList(M,e.memory[M],e.memory.$[M]):Lisa.learns(M,e.memory[M]))}}catch(e){T=!0,x=e}finally{try{!E&&k.return&&k.return()}finally{if(T)throw x}}Lisa.remembersMessages=!0;var z=!0,A=!1,R=void 0;try{for(var I,j=e.messages[Symbol.iterator]();!(z=(I=j.next()).done);z=!0){var N=I.value;Lisa.displayMessage(N[1],N[2],N[3],N[4])}}catch(e){A=!0,R=e}finally{try{!z&&j.return&&j.return()}finally{if(A)throw R}}Lisa.remembersMessages=e.histories,Lisa.locale=e.currentLocale},convertPlainSave:function(e,t,r){if(e.startsWith("L")){if("object"!==("undefined"==typeof LZString?"undefined":_typeof(LZString))||"function"!=typeof LZString.decompressFromUTF16)return void r("lzstring_not_found");e=this.reverseStr(LZString.decompressFromUTF16(this.reverseStr(e.substr(1))))}else{if(!e.startsWith("P"))return void r("unknown_header");e=this.reverseStr(e.substr(1))}if(e){try{e=JSON.parse(e)}catch(e){r("json")}e&&t(e)}},save:function(){for(var e=JSON.parse(Lisa.export()),t={handlers:[],memory:e.memory,messages:e.messages,catchers:e.catchers,locales:e.locales,currentLocale:e.currentLocale},r=0;r<e.handlers.length;r++)t.handlers.push([e.handled[r],e.handlers[r][3],e.handlers[r][4]]);return t.histories=Lisa.remembersMessages,e=null,t},convertObjectSave:function(e){return e=this.reverseStr(JSON.stringify(e)),e.length<102400||"object"!==("undefined"==typeof LZString?"undefined":_typeof(LZString))||"function"!=typeof LZString.compressToUTF16?"P"+e:"L"+this.reverseStr(LZString.compressToUTF16(e))},reverseStr:function(e){for(var t="",r=e.length-1;r>=0;r--)t+=e[r];return t}};var dicuss=document.getElementById("discuss"),input=document.createElement("input");input.setAttribute("id","input"),input.addEventListener("keydown",function(e){if(13===e.keyCode){if(!input.value.length)return;var t=input.value;input.value="",Lisa.hears(t),Lisa.does(t)}}),document.body.appendChild(input);var data=localStorage.getItem("lisa_state");data&&Lisa.State.convertPlainSave(data,function(e){return Lisa.State.load(e)},function(e){"lzstring"===e&&"object"===("undefined"==typeof console?"undefined":_typeof(console))&&"function"==typeof console.error&&console.error("Found compressed data, but the LZString library was not found."),"object"===("undefined"==typeof console?"undefined":_typeof(console))&&"function"==typeof console.error&&console.error("Corrupted data found in localStorage"),("object"===("undefined"==typeof window?"undefined":_typeof(window))?window:"object"===("undefined"==typeof global?"undefined":_typeof(global))?global:"object"===_typeof(void 0)?void 0:{}).corrupted_local_lisa_state=data,localStorage.removeItem("lisa_state")}),Lisa.when("message",function(e,t,r,n,i){var s=document.createElement("div");s.setAttribute("class","message message-"+n),s.innerHTML="<strong>"+t+" : </strong>"+r,discuss.appendChild(s);var a=discuss.scrollHeight-discuss.scrollTop,o=setInterval(function(){return discuss.scrollTop++},Math.floor(2e3/a));setTimeout(function(){return clearInterval(o)},2e3),localStorage.setItem("lisa_state",Lisa.State.convertObjectSave(Lisa.State.save()))}),Lisa.when("did",function(){return localStorage.setItem("lisa_state",Lisa.State.convertObjectSave(Lisa.State.save()))}),Lisa.when("understood",function(){return localStorage.setItem("lisa_state",Lisa.State.convertObjectSave(Lisa.State.save()))}),Lisa.Script={comparators:{"=":"===","==":"===",is:"===","!":"!==","!=":"!==","!==":"!==","is not":"!==",isnt:"!=="},functions:{listLength:"Lisa.thinksToListLength",lastValue:"Lisa.thinksToListLastValue",knowsValue:"Lisa.knowsValue",helpsAbout:"Lisa.helpsAbout",isList:"Lisa.isList",sort:"Lisa.sortsList",shuffle:"Lisa.shufflesList",reverse:"Lisa.reversesList",search:"Lisa.searchesValue",random:"Math.random",round:"Math.round",trunc:"Math.trunc",abs:"Math.abs",sin:"Math.sin",cos:"Math.cos",exp:"Math.exp",log:"Math.log",pow:"Math.pow",sqrt:"Math.sqrt",randInt:"Lisa.Script.libRandomInteger",int:"parseInt",float:"parseFloat",string:"Lisa.Script.libString",standard:"Lisa.getStandard",sum:"Lisa.Script.libSum",split:"String.prototype.split.call",join:"Array.prototype.join.call",concat:"Array.prototype.concat.call",get:"Lisa.thinksToCell"},transpileVar:function(e){return e.startsWith("$")?e.substr(1):e.startsWith("_")?"_a.caught["+e.substr(1)+"]":e.startsWith("^")?"_a.formatted["+e.substr(1)+"]":"true"===e||"false"===e?e:'Lisa.thinksToCell("'+e+'")'},transpile:function(e){var t=this;return('"'+e+'"').replace(/"(.*?)"/g,function(e){return e.replace(/([a-z]+) *\(/gi,function(e,r){return t.functions.hasOwnProperty(r)?t.functions[r]+"(":void error('Unknown function "'+r+'"')}).replace(/([^a-z0-9\^_\$]|^)(\$?[a-z][a-z0-9_]*|_(?:\d|[1-9]\d+)|\^(?:\d|[1-9]\d+))( *\[ *(.*?) *\]|)(?! *[\(\.a-z])/gi,function(e,r,n,i,s){return r+(i?n.startsWith("$")?"~"===s?n.substr(1)+".slice(-1)[0]":n.substr(1)+"["+t.transpile(s)+"]":"~"===s?'Lisa.thinksToListLastValue("'+n+'")':'Lisa.thinksToListValue("'+n+'",'+t.transpile(s)+")":t.transpileVar(n))})}).slice(1,-1).replace(/"(.*?)"/g,function(e){return e.replace(/%([a-z][a-z0-9_]*|_(?:\d|[1-9]\d+)|\^(?:\d|[1-9]\d+))%/g,function(e,r){return'"+'+t.transpileVar(r)+'+"'})}).replace(/""\+/g,"").replace(/\+""/g,"")},compile:function(e){function t(e){throw new Error("[LIS:compile] At line "+p+" :\n"+g+"\n^\n"+e)}function r(){for(var e=0;e<f-d;e++)y.includes(f-e-1)?(u+=(i?"\n"+"  ".repeat(d+e+2):"")+"return false;"+(i?"\n"+"  ".repeat(d+e+1):"")+"});",y.splice(y.indexOf(f-e-1),1)):u+=(i?"\n"+"  ".repeat(d+e+1):"")+"}";f=d}function n(){var e="_tmp"+m++;return c.push(e),e}var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if("string"!=typeof e)throw new Error("[LIS:compile] Invalid source code provided, must be a string");for(var o="",l=e.split(/\r\n|\r|\n/g),u="",c=[],f=0,d=void 0,h=void 0,p=0,g=void 0,y=[],m=0;p<l.length;)if(g=l[p++],d=g.match(/^(  |\t)*/)[0].replace(/  /g,"\t").length,g=g.trim(),g||a){if(g&&(f&&(d>f?t("Wrong indentation, expecting "+f+" tab"+(f>1?"s":"")+" but "+d+" given."):d<f&&r()),!f&&d&&t("Wrong indentation, expecting no tab"),i&&(o="\n"+"  ".repeat(f+1))),(h=g.match(/^else +/))&&(u+=o+"else ",g=g.substr(h[0].length)),"else"===g.toLocaleLowerCase())u+=o+"else{",f++;else if(g.startsWith("#"))s&&(u+=o+("/*"+g.substr(1)+"*/"));else if(h=g.match(/^(\$|)([a-z][a-z0-9_]*)( *\[ *(.*?) *\])? *= *(.*)$/i)){var v=!!h[1],w=h[2],L=!!h[3],b=h[4]?this.transpile(h[4]):null,_=this.transpile(h[5]);v?(c.includes(w)||c.push(w),u+=L?b?o+(w+"["+b+"]="+_+";"):o+(w+".push("+_+");"):o+(w+"="+_+";")):u+=L?b?o+('Lisa.learnsListValue("'+w+'",'+_+","+b+");"):o+('Lisa.learnsListValue("'+w+'",'+_+");"):o+('Lisa.learns("'+w+'",'+_+");")}else if("{{{"===g){for(var S="";++p;){if(p===l.length)throw new Error("[Lisa] JavaScript code's block has no end");if(g=l[p].trim(),"}}}"===g)break;S+="\n"+o.substr(1)+g}u+=o+S,p++}else if(h=g.match(/^if( +NOT *|) +([a-z][a-z0-9_]*|_\d+|\^\d+)$/i))u+=o+("if("+(h[1]?"!":"")+this.transpile(h[2])+"){"),f++;else if(h=g.match(/^if( +NOT *|) +knows +([a-z][a-z0-9_]*|_\d+|\^\d+)$/i))u+=o+("if("+(h[1]?"!":"")+'Lisa.knows("'+h[2]+'")){'),f++;else if(h=g.match(/^if( +NOT *|) +empty +([a-z][a-z0-9_]*)$/i))u+=o+("if("+(h[1]?"":"!")+'Lisa.thinksToListLength("'+h[2]+'")){'),f++;else if(h=g.match(/^if( +NOT *|) +(islist|is_list|list) +([a-z][a-z0-9_]*)$/i))u+=o+("if("+(h[1]?"!":"")+'Lisa.isList("'+h[3]+'")){'),f++;else if(h=g.match(/^if +(\$?[a-z][a-z0-9_]*|_\d+|\^\d+) *(<=|>=|<|>) *(\d+[.]?|\d*\.\d+)$/i))u+=o+("if("+this.transpileVar(h[1])+h[2]+h[3]+"){"),f++;else if(h=g.match(/^if +(.*?) *(\b(?:=|==|\!|\!=|\!==|is not|isnt|is)\b) *(.*?)$/i))u+=o+("if("+this.transpile(h[1])+this.comparators[h[2]]+this.transpile(h[3])+"){"),f++;else if(h=g.match(/^say +(.*)$/i))u+=o+("Lisa.says("+this.transpile(h[1])+");");else if(h=g.match(/^(end|return|die|output) +(.*)$/i))u+=o+"return "+this.transpile(h[2])+";";else if(h=g.match(/^(store|set|learn|rem|remember|mem|memorize|save)[s]? +(.*?) *(=>|in|to) *([a-z][a-z0-9_]*)$/i))u+=o+('Lisa.learns("'+h[3]+'",'+this.transpile(h[2])+");");else if(h=g.match(/^(for +|understands? +|with +|)"(.*)" *(=>|do)$/i))u+=o+('Lisa.understands("'+h[2]+'",function(){'+(o?o+"  ":"")+"var _a=arguments[0],Lisa=_a.caller;"),y.push(f),f++;else if(h=g.match(/^for +\$([a-z][a-z0-9_]*) +(in|of) +(.*?) +(to|\.\.|=>|->) +(.*)$/i))c.includes(h[1])||c.push(h[1]),u+=o+("for("+h[1]+"="+this.transpile(h[3])+";"+h[1]+"<="+this.transpile(h[5])+";i++){"),f++;else if(h=g.match(/^for *each +\$([a-z][a-z0-9_]*) +(in|of) +(.*?)$/i)){c.includes(h[1])||c.push(h[1]);var $=n(),E=n();u+=o+($+"="+this.transpile(h[3])+";")+o+("for("+E+"=0;"+E+"<"+$+".length;"+E+"++){")+o+("  "+h[1]+"="+$+"["+E+"];"),f++}else(h=g.match(/^(requests?|asks?|does) +"(.*)"$/i))?u+=o+('Lisa.hears("'+h[2]+'");Lisa.does("'+h[2]+'");'):(h=g.match(/^(unstore|unset|unlearn|unremember|unmemorize|unsave|forget|delete)[s]? +([a-z][a-z0-9_]*)$/i))?u+=o+('Lisa.forgets("'+h[2]+'");'):(h=g.match(/^(makelist|createlist|setlist) +(bool|boolean|int|integer|float|floating|str|string) +([a-z][a-z0-9_]*)$/i))?u+=o+('Lisa.learnsList("'+h[3]+'",[],"'+h[2]+'");'):(h=g.match(/^(pushlist|push|append|add) +(.*?) +(=>|in|to) +([a-z][a-z0-9_]*)$/i))?u+=o+('Lisa.learnsListValue("'+h[4]+'",'+this.transpile(h[2])+");"):(h=g.match(/^(sorts?_?a?|sorts?_?asc|sorts?_?list|sorts?_?list_?asc) +([a-zA-Z][a-zA-Z0-9_]*)$/i))?u+=o+('Lisa.sortsList("'+h[2]+'",true);'):(h=g.match(/^(sorts?|sorts?_?d?|sorts?_?desc|sorts?_?list_?d|sorts?_?list_?desc) +([a-z][a-z0-9_]*)$/i))?u+=o+('Lisa.sortsList("'+h[2]+'",true,false);'):(h=g.match(/^(shuffles?|shuffles?_?list|rand_?list|randomize_?list|randomize) +([a-z][a-z0-9_]*)$/i))?u+=o+('Lisa.shufflesList("'+h[2]+'",true);'):(h=g.match(/^(reverses?|reverses?_?list) +([a-z][a-z0-9_]*)$/i))?u+=o+('Lisa.reversesList("'+h[2]+",true);"):(h=g.match(/^(set_?locale|use_?locale|locale) +"([a-z]{2})"$/i))?u+=o+('Lisa.usesLocale("'+h[2].toLocaleLowerCase()+'");'):(h=g.match(/^(in +|for +|with +|)locale +"([a-z]{2})" +(use|register|pattern) +\{ *(.*?) *\}$/i))?u+=o+('Lisa.learnsLocaleTexts("'+h[2].toLocaleLowerCase()+'",'+JSON.stringify(h[4].replace(/''/g,"'").split(/ *\| */))+");"):(h=g.match(/^(js|javascript|script) +(.*)$/i))?u+=o+("eval("+this.transpile(h[2])+");"):(h=g.match(/^(eval|evaluate|lis|run) +(.*)$/i))?u+=o+("eval(Lisa.Script.compile("+this.transpile(h[2])+"));"):(h=g.match(/^define +(bool|boolean|int|integer|float|floating|str|string) +([a-z][a-z0-9_]*) *\[ *\]$/i))?u+=o+('if(!Lisa.knows("'+h[2]+'"))Lisa.learnsList("'+h[2]+'",[],"'+h[1]+'");'):(h=g.match(/^init +([a-z][a-z0-9_]*)$/))?(u+=o+('if(!Lisa.knows("'+h[1]+'")){')+o+(o?"  ":"")+('Lisa.learns("'+h[1]+'",true);'),f++):g&&t("Syntax error");a&&a({line:g,lineIndex:p,indent:d,indented:f,total:l.length,progress:Math.floor(p/l.length*100)})}return d=0,
r(),"(function(){"+(c.length?"var "+c.join(",")+";":"")+u+(i?"\n":"")+"})();"},exec:function(e){new Function(["Lisa"],this.compile(e))(Lisa)},download:function(e){var t=this,r=void 0;if("string"!=typeof e||!e)throw new Error("[LIS:download] Illegal URL provided, must be a not-empty string");if(e.startsWith("file://"))throw new Error('[LIS:download] Protocol "file:///" is forbidden: Lisa is not allowed to load local computer\'s resources');(r=e.match(/^presets?:\/\/\/?((?:[a-zA-Z_0-9][\/\\]?)+)(\.lis|)$/i))&&(e=location.href.split("/").slice(0,-1).join("/")+"/presets/"+r[1].split("\\").join("/")+".lis");var n=getXMLHttpRequest();n.open("GET",e,!0),n.addEventListener("readystatechange",function(e){if(4===n.readyState){if(200!==n.status)throw new Error("[LIS:download] Failed to download the LIS program (status code: "+n.status+")");t.exec(n.responseText)}}),n.send(null)},libRandomInteger:function(e,t){return"undefined"==typeof t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},libString:function(e){if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(Array.isArray(e)||"object"===("undefined"==typeof e?"undefined":_typeof(e))&&e)return JSON.stringify(e);if(null===e)return"null";if(void 0===e)return"undefined";if(e===1/0)return"Infinity";if(Number.isNaN(e))return"NaN";throw new Error("[LIS:exec] Content can't be stringified")},libSum:function(e){return e.reduce(function(e,t){return e+t},0)}};