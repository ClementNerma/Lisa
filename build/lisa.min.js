'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(d){return typeof d}:function(d){return d&&'function'==typeof Symbol&&d.constructor===Symbol&&d!==Symbol.prototype?'symbol':typeof d},RegexCatchers={'*':function _(){return'(.*?)'},number:function number(){return'(\\d+[.]?|\\d*\\.\\d+)'},integer:function integer(){return'(\\d+)'},short_time:function short_time(){return'((?:[01]?\\d|2[0-3])(?: *: *| +'+Lisa.thinksTo('HOURS_NAME')+' +)[0-5]\\d(?:| +'+Lisa.thinksTo('MINUTES_NAME')+'))'},time:function time(){return'((?:[01]?\\d|2[0-3])(?: *: *| +'+Lisa.thinksTo('HOURS_NAME')+' +)[0-5]\\d(?: *: *| +'+Lisa.thinksTo('MINUTES_NAME')+' +)[0-5]\\d))(?:|'+Lisa.thinksTo('SECONDS_NAME')+')'},short_date:function short_date(){return'((?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *[\\/\\-\\.] *| +(?:'+Lisa.thinksTo('MONTHS').split(',').join('|')+'))'},date:function date(){return'((?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *[\\/\\-\\.] *| +(?:'+Lisa.thinksTo('MONTHS').split(',').join('|')+') +)\\d{4})'}},Lisa=new function(){var g=this,h=document.createElement('div'),j=[],k=[],l=!0,m={},p=[],q=[],r={message:null,did:null,learnt:null,forgot:null,understood:null};function d(t){var u=1<arguments.length&&arguments[1]!==void 0?arguments[1]:2;return'0'.repeat(u-t.length)+t}this.escapeHtml=function(t){return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;')},this.getStandard=function(t,u){if(!RegexCatchers.hasOwnProperty(u)&&'?'!==u)throw new Error('[Lisa] Unknown catcher "'+u+'"');if(['*','?','number','integer'].includes(u))return t;var v;switch(u){case'short_time':return t.replace(/^([0-9]+).*([0-9]+)$/,function(B,C,D){return d(C)+':'+d(D)});case'time':return t.replace(/^([0-9]+).*([0-9]+).*([0-9]+)$/,d($1)+':'+d($2)+':'+d($3));case'short_date':v=Lisa.thinksTo('MONTHS').split(',');for(var y,x=function _loop(B){if(t.includes(v))return{v:t.replace(/\d+/,function(C){return d(C)+'/'+d(B.toString())})}},B=0;B<v.length;B++)if(y=x(B),'object'===('undefined'==typeof y?'undefined':_typeof(y)))return y.v;return t.replace(/(\d+).*?(\d+)/,function(B,C,D){return d(C)+'/'+d(D)});case'date':v=Lisa.thinksTo('MONTHS').split(',');for(var A,z=function _loop2(B){if(t.includes(v[B]))return{v:t.replace(/(\d+).*?(\d+)/,function(C,D,E){return d(D)+'/'+d((B+1).toString())+'/'+d(E,4)})}},B=0;B<v.length;B++)if(A=z(B),'object'===('undefined'==typeof A?'undefined':_typeof(A)))return A.v;return t.replace(/(\d+).*?(\d+).*?(\d+)/,function(B,C,D,E){return d(C)+'/'+d(D)+'/'+d(E,4)});default:throw new Error('[Lisa] [BUG] Unreferenced catcher "'+u+'"');}},this.format=function(t){return g.escapeHtml(t).replace(/\*(.*?)\*/g,'<strong>$1</strong>').replace(/_(.*?)_/g,'<em>$1</em>').replace(/~(.*?)~/g,'<del>$1</del>').replace(/%([a-zA-Z][a-zA-Z0-9_]*)%/g,function(u,v){if(Lisa.knows(v))return Lisa.thinksTo(v);throw new Error('[Lisa] Variable "'+v+'" is not defined in message "'+t+'"')})},this.makeHandlerRegex=function(t){var u=1<arguments.length&&arguments[1]!==void 0&&arguments[1],v=[],x=new RegExp('^'+t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,'\\$&').replace(/ /g,' +').replace(/\\\{(.*?)\\\}/g,function(y,z){if(z.startsWith('\\?'))return v.push('?'),z.substr(2).includes('\\|')?':'===z.substr(2,1)?'('+z.substr(3).split('\\|').join('|')+'|)':'('+z.substr(2).split('\\|').join('|')+')':'('+z.substr(2)+'|)';if('\\*'===z&&(z='*'),!RegexCatchers.hasOwnProperty(z))throw new Error('[Lisa] Unknown catcher "'+z+'"');return v.push(z),RegexCatchers[z]()}).replace(/( \+)?\\\.$/,' *(?:[\\.]*)?').replace(/( \+)?\\\?$/,' *(?:[\\?]*)?')+'(?: *[!\\.])*$','i');return u?[x,v]:x},this.when=function(t,u){if(!r.hasOwnProperty(t))throw new Error('[Lisa] Unknown event name');if('function'!=typeof u)throw new Error('[Lisa] Illegal callback provided, must be a function');r[t]=u},this.understands=function(t,u){var v=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},x=arguments[3];if(p.includes(t))throw new Error('[Lisa] Handler is already in use');if('string'==typeof u)u=new Function([],Reflect.ownKeys(v).map(function(E){return'Lisa.learns("'+E+'","'+v[E].replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function(F,G){return'"+arguments[0].formatted['+G+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function(F,G){return'"+arguments[0].caught['+G+']+"'})+'");'})+'return "'+u.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function(E,F){return'"+arguments[0].formatted['+F+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function(E,F){return'"+arguments[0].caught['+F+']+"'})+'"');else if('function'==typeof u)v&&function(){var E=u;u=function callback(G){var H=!0,I=!1,J=void 0;try{for(var L,M,K=Reflect.ownKeys(v)[Symbol.iterator]();!(H=(L=K.next()).done);H=!0)M=L.value,Lisa.learns(M,v[M].replace(/\$\^(\d|[1-9]\d+)/g,function(N,O){return G.formatted[O]}).replace(/\$_(\d|[1-9]\d+)/g,function(N,O){return G.caught[O]}))}catch(M){I=!0,J=M}finally{try{!H&&K.return&&K.return()}finally{if(I)throw J}}return E.call(g,G)}}();else throw new Error('[Lisa] Illegal handler\'s callback provided');var y=g.makeHandlerRegex(t,!0);if(x){if(!Array.isArray(x))throw new Error('[Lisa] Illegal help text argument provided');if(x.length!==y[1].length)throw new Error('[Lisa] Insufficient help for parameters in handler "'+t+'"');var z=!0,A=!1,B=void 0;try{for(var D,E,C=x[Symbol.iterator]();!(z=(D=C.next()).done);z=!0)if(E=D.value,!['string','function'].includes('undefined'==typeof E?'undefined':_typeof(E)))throw new Error('[Lisa] Illegal help text given for handler "'+t+'"')}catch(E){A=!0,B=E}finally{try{!z&&C.return&&C.return()}finally{if(A)throw B}}}return q.push([y[0],y[1],u,x||null]),p.push(t),r.understood&&r.understood(new RegExp(y[0].toString().slice(1,-2)),y[1].slice(0),u,x?x.slice(0):null),y[0]},this.displayMessage=function(t,u,v){var x=document.createElement('div');x.setAttribute('class','message message-'+v),x.innerHTML='<strong>'+t+' : </strong>'+g.format(u),h.appendChild(x);var y=h.scrollHeight-h.scrollTop,z=setInterval(function(){return h.scrollTop++},Math.floor(2e3/y));setTimeout(function(){return clearInterval(z)},2e3),l&&j.push([Date.now(),t,u,v]),r.message&&r.message(Date.now(),t,u,v)},this.helpsAbout=function(t){var u=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(!p.includes(t))throw new Error('[Lisa] Unknown handler "'+t+'"');var v=q[p.indexOf(t)][3];if(!v)return!1;if(u)return v.slice(0);var x=0;return t.replace(/\{(.*?)\}/g,function(){return'['+v[x++]+']'})},this.learns=function(t,u){if('string'!=typeof t||!t.length||{}[t])throw new Error('[Lisa] Illegal name provided for memory\'s cell');if(!['string','number','boolean'].includes('undefined'==typeof u?'undefined':_typeof(u)))throw new Error('[Lisa] Illegal value provided for memory\'s cell "'+t+'"');m[t]=u,r.remembered&&r.remembered(t,u)},this.knows=function(t){return m.hasOwnProperty(t)},this.thinksTo=function(t){return m.hasOwnProperty(t)?m[t]:void 0},this.forgets=function(t){if(!m.hasOwnProperty(t))throw new Error('[Lisa] Can\'t forget unexisting cell doesn\'t exist');var u=m[t];return delete m[t],r.forgot&&r.forgot(t,u),u},this.says=function(t){return g.displayMessage('Lisa',t,'lisa')},this.hears=function(t){return g.displayMessage('You',t,'user')},this.does=function(t){var u=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,v=t;t=t.trim();var x,y=!0,z=!1,A=void 0;try{for(var C,D,B=q[Symbol.iterator]();!(y=(C=B.next()).done);y=!0)if(D=C.value,x=t.match(D[0])){for(var E={request:t,requestWithSpaces:v,caught:x.slice(1),formatted:[],handlerRegex:D[0],catchers:D[1],callback:D[2],help:D[3],handler:p[q.indexOf(D)],display:!!u},H=0;H<D[1].length;H++)E.formatted.push(g.getStandard(x[H+1],D[1][H]));var F=D[2].call(g,E),G=!1;return'number'==typeof F?F=G.toString():F&&F instanceof HTMLElement?(F=G.innerHTML,G=!0):'string'!=typeof F&&(F='Sorry, I encountered a problem. Please try again.'),u&&g.says(F,G),l&&k.push([Date.now(),E.requestWithSpaces,E.handler,E.caught.slice(0),E.display]),r.did&&r.did(k.slice(-1)[0],JSON.parse(JSON.stringify(E))),F}}catch(D){z=!0,A=D}finally{try{!y&&B.return&&B.return()}finally{if(z)throw A}}g.says('I didn\'t understand your request.',!0)},this.nowRemembersMessages=function(){l=!0},this.doesntRememberMessages=function(){l=!1},this.getMessage=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if('number'!=typeof t||Math.floor(t)!==t)throw new Error('[Lisa] Invalid ID given while getting message');if(0>t&&(t=-t),j.length<=t)throw new Error('[Lisa] There is no message with id "'+t+'"');return j.slice(0)},this.export=function(){var t=[],u=!0,v=!1,x=void 0;try{for(var z,A,y=q[Symbol.iterator]();!(u=(z=y.next()).done);u=!0)A=z.value,t.push([A[0].toString(),A[1],A[2].toString(),A[3]])}catch(A){v=!0,x=A}finally{try{!u&&y.return&&y.return()}finally{if(v)throw x}}return JSON.stringify({memory:m,handled:p,handlers:t,rememberMessages:l,messages:j,requests:k})},this.learns('HOURS_NAME','hours'),this.learns('MINUTES_NAME','minutes'),this.learns('SECONDS_NAME','secondes'),this.learns('MONTHS','january,february,march,april,may,june,july,august,september,october,november,december'),this.__defineGetter__('dom',function(){return h}),this.__defineGetter__('memory',function(){return JSON.parse(JSON.stringify(m))}),this.__defineGetter__('messages',function(){return JSON.parse(JSON.stringify(j))}),this.__defineGetter__('history',function(){return JSON.parse(JSON.stringify(k))}),this.__defineGetter__('remembersMessages',function(){return l}),this.__defineSetter__('remembersMessages',function(t){return t?g.nowRemembersMessages():g.doesntRememberMessages()})},LZString=function(){function d(m,p){if(!k[m]){k[m]={};for(var q=0;q<m.length;q++)k[m][m.charAt(q)]=q}return k[m][p]}var g=String.fromCharCode,h='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',j='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$',k={},l={compressToBase64:function compressToBase64(m){if(null==m)return'';var p=l._compress(m,6,function(q){return h.charAt(q)});switch(p.length%4){default:case 0:return p;case 1:return p+'===';case 2:return p+'==';case 3:return p+'=';}},decompressFromBase64:function decompressFromBase64(m){return null==m?'':''==m?null:l._decompress(m.length,32,function(p){return d(h,m.charAt(p))})},compressToUTF16:function compressToUTF16(m){return null==m?'':l._compress(m,15,function(p){return g(p+32)})+' '},decompressFromUTF16:function decompressFromUTF16(m){return null==m?'':''==m?null:l._decompress(m.length,16384,function(p){return m.charCodeAt(p)-32})},compressToUint8Array:function compressToUint8Array(m){for(var u,p=l.compress(m),q=new Uint8Array(2*p.length),r=0,t=p.length;r<t;r++)u=p.charCodeAt(r),q[2*r]=u>>>8,q[2*r+1]=u%256;return q},decompressFromUint8Array:function decompressFromUint8Array(m){if(null===m||m===void 0)return l.decompress(m);var p=function(){for(var q=Array(m.length/2),t=0,u=q.length;t<u;t++)q[t]=256*m[2*t]+m[2*t+1];var r=[];return q.forEach(function(t){r.push(g(t))}),{v:l.decompress(r.join(''))}}();if('object'===('undefined'==typeof p?'undefined':_typeof(p)))return p.v},compressToEncodedURIComponent:function compressToEncodedURIComponent(m){return null==m?'':l._compress(m,6,function(p){return j.charAt(p)})},decompressFromEncodedURIComponent:function decompressFromEncodedURIComponent(m){return null==m?'':''==m?null:(m=m.replace(/ /g,'+'),l._decompress(m.length,32,function(p){return d(j,m.charAt(p))}))},compress:function compress(m){return l._compress(m,16,function(p){return g(p)})},_compress:function _compress(m,p,q){if(null==m)return'';var r=void 0,t,u={},v={},x='',y='',z='',A=2,B=3,C=2,D=[],E=0,F=0,G;for(G=0;G<m.length;G+=1)if(x=m.charAt(G),Object.prototype.hasOwnProperty.call(u,x)||(u[x]=B++,v[x]=!0),y=z+x,Object.prototype.hasOwnProperty.call(u,y))z=y;else{if(Object.prototype.hasOwnProperty.call(v,z)){if(256>z.charCodeAt(0)){for(r=0;r<C;r++)E<<=1,F==p-1?(F=0,D.push(q(E)),E=0):F++;for(t=z.charCodeAt(0),r=0;8>r;r++)E=E<<1|1&t,F==p-1?(F=0,D.push(q(E)),E=0):F++,t>>=1}else{for(t=1,r=0;r<C;r++)E=E<<1|t,F==p-1?(F=0,D.push(q(E)),E=0):F++,t=0;for(t=z.charCodeAt(0),r=0;16>r;r++)E=E<<1|1&t,F==p-1?(F=0,D.push(q(E)),E=0):F++,t>>=1}A--,0==A&&(A=Math.pow(2,C),C++),delete v[z]}else for(t=u[z],r=0;r<C;r++)E=E<<1|1&t,F==p-1?(F=0,D.push(q(E)),E=0):F++,t>>=1;A--,0==A&&(A=Math.pow(2,C),C++),u[y]=B++,z=x+''}if(''!==z){if(Object.prototype.hasOwnProperty.call(v,z)){if(256>z.charCodeAt(0)){for(r=0;r<C;r++)E<<=1,F==p-1?(F=0,D.push(q(E)),E=0):F++;for(t=z.charCodeAt(0),r=0;8>r;r++)E=E<<1|1&t,F==p-1?(F=0,D.push(q(E)),E=0):F++,t>>=1}else{for(t=1,r=0;r<C;r++)E=E<<1|t,F==p-1?(F=0,D.push(q(E)),E=0):F++,t=0;for(t=z.charCodeAt(0),r=0;16>r;r++)E=E<<1|1&t,F==p-1?(F=0,D.push(q(E)),E=0):F++,t>>=1}A--,0==A&&(A=Math.pow(2,C),C++),delete v[z]}else for(t=u[z],r=0;r<C;r++)E=E<<1|1&t,F==p-1?(F=0,D.push(q(E)),E=0):F++,t>>=1;A--,0==A&&(A=Math.pow(2,C),C++)}for(t=2,r=0;r<C;r++)E=E<<1|1&t,F==p-1?(F=0,D.push(q(E)),E=0):F++,t>>=1;for(;;)if(E<<=1,F==p-1){D.push(q(E));break}else F++;return D.join('')},decompress:function decompress(m){return null==m?'':''==m?null:l._decompress(m.length,32768,function(p){return m.charCodeAt(p)})},_decompress:function _decompress(m,p,q){var r=[],t,u=4,v=4,x=3,y='',z=[],A,B,C,D,E,F,G,H={val:q(0),position:p,index:1};for(A=0;3>A;A+=1)r[A]=A;for(C=0,E=Math.pow(2,2),F=1;F!=E;)D=H.val&H.position,H.position>>=1,0==H.position&&(H.position=p,H.val=q(H.index++)),C|=(0<D?1:0)*F,F<<=1;switch(t=C){case 0:for(C=0,E=Math.pow(2,8),F=1;F!=E;)D=H.val&H.position,H.position>>=1,0==H.position&&(H.position=p,H.val=q(H.index++)),C|=(0<D?1:0)*F,F<<=1;G=g(C);break;case 1:for(C=0,E=Math.pow(2,16),F=1;F!=E;)D=H.val&H.position,H.position>>=1,0==H.position&&(H.position=p,H.val=q(H.index++)),C|=(0<D?1:0)*F,F<<=1;G=g(C);break;case 2:return'';}for(r[3]=G,B=G,z.push(G);;){if(H.index>m)return'';for(C=0,E=Math.pow(2,x),F=1;F!=E;)D=H.val&H.position,H.position>>=1,0==H.position&&(H.position=p,H.val=q(H.index++)),C|=(0<D?1:0)*F,F<<=1;switch(G=C){case 0:for(C=0,E=Math.pow(2,8),F=1;F!=E;)D=H.val&H.position,H.position>>=1,0==H.position&&(H.position=p,H.val=q(H.index++)),C|=(0<D?1:0)*F,F<<=1;r[v++]=g(C),G=v-1,u--;break;case 1:for(C=0,E=Math.pow(2,16),F=1;F!=E;)D=H.val&H.position,H.position>>=1,0==H.position&&(H.position=p,H.val=q(H.index++)),C|=(0<D?1:0)*F,F<<=1;r[v++]=g(C),G=v-1,u--;break;case 2:return z.join('');}if(0==u&&(u=Math.pow(2,x),x++),r[G])y=r[G];else if(G===v)y=B+B.charAt(0);else return null;z.push(y),r[v++]=B+y.charAt(0),u--,B=y,0==u&&(u=Math.pow(2,x),x++)}}};return l}();Lisa.dom.setAttribute('id','discuss'),document.body.appendChild(Lisa.dom);var input=document.createElement('input');input.setAttribute('id','input'),input.addEventListener('keydown',function(d){if(13===d.keyCode){if(!input.value.length)return;var g=input.value;input.value='',Lisa.hears(g),Lisa.does(g)}}),document.body.appendChild(input);function loadState(d){if(console.log(d),'object'!==('undefined'==typeof d?'undefined':_typeof(d))||!d||Array.isArray(d))throw new Error('[Lisa:load] State to load must be an object');if(!Array.isArray(d.handlers)||'object'!==_typeof(d.memory)||!d.memory||Array.isArray(d.memory)||!Array.isArray(d.messages)||'boolean'!=typeof d.histories)throw new Error('[Lisa:load] Fields are missing or corrupted in the state object');var g=!0,h=!1,j=void 0;try{for(var l,k=d.handlers[Symbol.iterator]();!(g=(l=k.next()).done);g=!0){var A=l.value,B=A[1].match(/^function.*?\((?:(?: |\n)*)([a-zA-Z][a-zA-Z0-9_]*|)(?:\n\/\*\*\/|)(?:(?: |\n)*)\)(?:(?: |\n)*)\{((?:.|\n)*)\}$/);Lisa.understands(A[0],new Function([B[1]],B[2]),A[2])}}catch(A){h=!0,j=A}finally{try{!g&&k.return&&k.return()}finally{if(h)throw j}}var m=!0,p=!1,q=void 0;try{for(var t,A,r=Reflect.ownKeys(d.memory)[Symbol.iterator]();!(m=(t=r.next()).done);m=!0)A=t.value,Lisa.learns(A,d.memory[A])}catch(A){p=!0,q=A}finally{try{!m&&r.return&&r.return()}finally{if(p)throw q}}Lisa.remembersMessages=!0;var u=!0,v=!1,x=void 0;try{for(var z,A,y=d.messages[Symbol.iterator]();!(u=(z=y.next()).done);u=!0)A=z.value,Lisa.displayMessage(A[1],A[2],A[3])}catch(A){v=!0,x=A}finally{try{!u&&y.return&&y.return()}finally{if(v)throw x}}Lisa.rememberMessages=d.histories}function saveState(){for(var d=JSON.parse(Lisa.export()),g={handlers:[],memory:d.memory,messages:d.messages},h=0;h<d.handlers.length;h++)g.handlers.push([d.handled[h],d.handlers[h][2],d.handlers[h][3]]);g.histories=Lisa.remembersMessages,g=JSON.stringify(g),d=null,g<102400?localStorage.setItem('lisa_state','P'+g):localStorage.setItem('lisa_state','L'+reverse(LZString.compressToUTF16(reverse(g))))}function reverse(d){for(var g='',h=d.length-1;0<=h;h--)g+=d[h];return g}var data=localStorage.getItem('lisa_state');if(data){var d=function corrupted(){'object'===('undefined'==typeof console?'undefined':_typeof(console))&&'function'==typeof console.error&&console.error('Corrupted data found in localStorage'),('object'===('undefined'==typeof window?'undefined':_typeof(window))?window:'object'===('undefined'==typeof global?'undefined':_typeof(global))?global:'object'===_typeof(this)?this:{}).corrupted_local_lisa_state=data,localStorage.removeItem('lisa_state'),data=null};if(data.startsWith('L')?data=reverse(LZString.decompressFromUTF16(reverse(data.substr(1)))):data.startsWith('P')?data=reverse(data.substr(1)):d(),data){try{data=JSON.parse(data)}catch(g){d()}data&&loadState(data)}}Lisa.when('message',saveState),Lisa.when('did',saveState),Lisa.when('learnt',saveState),Lisa.when('forgot',saveState),Lisa.when('understood',saveState);
