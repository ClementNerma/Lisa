"use strict";function loadState(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e))||!e||Array.isArray(e))throw new Error("[Lisa:load] State to load must be an object");if(!Array.isArray(e.handlers)||"object"!==_typeof(e.memory)||!e.memory||Array.isArray(e.memory)||!Array.isArray(e.messages)||"boolean"!=typeof e.histories)throw new Error("[Lisa:load] Fields are missing or corrupted in the state object");var t=!0,r=!1,n=void 0;try{for(var i,s=e.handlers[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var a=i.value,o=a[1].match(/^function.*?\((?:(?: |\n)*)([a-zA-Z][a-zA-Z0-9_]*|)(?:\n\/\*\*\/|)(?:(?: |\n)*)\)(?:(?: |\n)*)\{((?:.|\n)*)\}$/);Lisa.understands(a[0],new Function([o[1]],o[2]),null,a[2])}}catch(e){r=!0,n=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw n}}var l=!0,u=!1,c=void 0;try{for(var d,f=Reflect.ownKeys(e.memory)[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var h=d.value;"$"!==h&&(e.memory.$.hasOwnProperty(h)?Lisa.learnsList(h,e.memory[h],e.memory.$[h]):Lisa.learns(h,e.memory[h]))}}catch(e){u=!0,c=e}finally{try{!l&&f.return&&f.return()}finally{if(u)throw c}}Lisa.remembersMessages=!0;var p=!0,g=!1,m=void 0;try{for(var y,v=e.messages[Symbol.iterator]();!(p=(y=v.next()).done);p=!0){var w=y.value;Lisa.displayMessage(w[1],w[2],w[3],w[4])}}catch(e){g=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(g)throw m}}Lisa.remembersMessages=e.histories}function saveState(){for(var e=JSON.parse(Lisa.export()),t={handlers:[],memory:e.memory,messages:e.messages},r=0;r<e.handlers.length;r++)t.handlers.push([e.handled[r],e.handlers[r][3],e.handlers[r][4]]);t.histories=Lisa.remembersMessages,t=JSON.stringify(t),e=null,t.length<102400||"object"!==("undefined"==typeof LZString?"undefined":_typeof(LZString))||"function"!=typeof LZString.compressToUTF16?localStorage.setItem("lisa_state","P"+reverse(t)):localStorage.setItem("lisa_state","L"+reverse(LZString.compressToUTF16(reverse(t))))}function reverse(e){for(var t="",r=e.length-1;r>=0;r--)t+=e[r];return t}function getXMLHttpRequest(){if(!window.ActiveXObject)return new XMLHttpRequest;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){return new ActiveXObject("Microsoft.XMLHTTP")}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Lisa=new function(){function e(e){return"("+i[e]()+")"}function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"0".repeat(t-e.length)+e}function r(e,t){switch(t){case"boolean":return e===!1||e===!0;case"integer":return!("number"!=typeof e||Math.floor(e)!==e||e<0);case"floating":return"number"==typeof e;case"string":return"string"==typeof e}}var n=this,i={"*":function(){return".*?"},digit:function(){return"\\d"},number:function(){return"\\d+[.]?|\\d*\\.\\d+"},unsigned_number:function(){return"[-]?"+i.number()},integer:function(){return"\\d+"},unsigned_integer:function(){return"[-]?"+i.integer()},letter:function(){return"[a-zA-Z]"},alphanum:function(){return"[a-zA-Z0-9]"},short_time:function(){return"(?:[01]?\\d|2[0-3])(?: *: *| +"+Lisa.thinksTo("HOURS_NAME")+" +)[0-5]\\d(?:| +"+Lisa.thinksTo("MINUTES_NAME")+")"},time:function(){return"(?:[01]?\\d|2[0-3])(?: *: *| +"+Lisa.thinksTo("HOURS_NAME")+" +)[0-5]\\d(?: *: *| +"+Lisa.thinksTo("MINUTES_NAME")+" +)[0-5]\\d))(?:|"+Lisa.thinksTo("SECONDS_NAME")},short_date:function(){return"(?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *[\\/\\-\\.] *| +(?:"+Lisa.thinksTo("MONTHS").split(",").join("|")+")"},date:function(){return"(?:[1-9]|0[1-9]|[12]\\d|3[01])(?: *[\\/\\-\\.] *(?:[1-9]|0[1-9]|1[0-2]) *[\\/\\-\\.] *| +(?:"+Lisa.thinksTo("MONTHS").split(",").join("|")+") +)\\d{4}"},email:function(){return'(?:(?:[^<>\\(\\)\\[\\]\\.,;:\\s@\\"]+(?:\\.[^<>()\\[\\]\\.,;:\\s@\\"]+)*)|(?:\\".+\\"))@(?:(?:[^<>()[\\]\\.,;:\\s@\\"]+\\.)+[^<>\\(\\)[\\]\\.,;:\\s@\\"]{2,})'},url:function(){return"(?:https?:\\/\\/|)(?:www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,6}\\b[-a-zA-Z0-9@:%_\\+.~#?&//=]*(?:#.*|)"}},s=Reflect.ownKeys(i),a=document.createElement("div"),o=[],l=[],u=!0,c={$:{}},d=[],f=[],h={message:null,did:null,learnt:null,forgot:null,understood:null};this.escapeHtml=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},this.getStandard=function(e,r){if(!i.hasOwnProperty(r)&&"?"!==r&&"#"!==r)throw new Error('[Lisa] Unknown catcher "'+r+'"');var n=void 0;switch(r){case"short_time":return e.replace(/^([0-9]+).*([0-9]+)$/,function(e,r,n){return t(r)+":"+t(n)});case"time":return e.replace(/^([0-9]+).*([0-9]+).*([0-9]+)$/,t($1)+":"+t($2)+":"+t($3));case"short_date":n=Lisa.thinksTo("MONTHS").split(",");for(var s=function(r){if(e.includes(n))return{v:e.replace(/\d+/,function(e){return t(e)+"/"+t(r.toString())})}},a=0;a<n.length;a++){var o=s(a);if("object"===("undefined"==typeof o?"undefined":_typeof(o)))return o.v}return e.replace(/(\d+).*?(\d+)/,function(e,r,n){return t(r)+"/"+t(n)});case"date":n=Lisa.thinksTo("MONTHS").split(",");for(var l=function(r){if(e.includes(n[r]))return{v:e.replace(/(\d+).*?(\d+)/,function(e,n,i){return t(n)+"/"+t((r+1).toString())+"/"+t(i,4)})}},a=0;a<n.length;a++){var u=l(a);if("object"===("undefined"==typeof u?"undefined":_typeof(u)))return u.v}return e.replace(/(\d+).*?(\d+).*?(\d+)/,function(e,r,n,i){return t(r)+"/"+t(n)+"/"+t(i,4)});default:return e}},this.format=function(e){return n.escapeHtml(e).replace(/\*(.*?)\*/g,"<strong>$1</strong>").replace(/_(.*?)_/g,"<em>$1</em>").replace(/~(.*?)~/g,"<del>$1</del>").replace(/%([a-zA-Z][a-zA-Z0-9_]*)%/g,function(t,r){if(Lisa.knows(r))return Lisa.thinksTo(r);throw new Error('[Lisa] Variable "'+r+'" is not defined in message "'+e+'"')})},this.makeHandlerRegex=function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=[],o=new RegExp("^"+t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\!]/g,"\\$&").replace(/ /g," +").replace(/\\\{(.*?)\\\}/g,function(t,r){if(r.startsWith("\\?"))return a.push("?"),r.substr(2).includes("\\|")?":"===r.substr(2,1)?"("+r.substr(3).split("\\|").join("|")+"|)":"("+r.substr(2).split("\\|").join("|")+")":"("+r.substr(2)+"|)";if(r.startsWith("#"))return a.push("#"),"("+r.substr(1).replace(/\\([\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|])/g,"$1")+")";if("\\*"===r)return a.push("*"),e("*");if(!i.hasOwnProperty(r))throw new Error('[Lisa] Unknown catcher "'+r+'"');return s?"(.*?)":(a.push(r),e(r))}).replace(/( \+)?\\\.$/," *(?:[\\.]*)?").replace(/( \+)?\\\?$/," *(?:[\\?]*)?")+"(?: *[!\\.])*$","i");return r?[o,a,n.makeHandlerRegex(t,!1,!0)]:o},this.when=function(e,t){if(!h.hasOwnProperty(e))throw new Error("[Lisa] Unknown event name");if("function"!=typeof t)throw new Error("[Lisa] Illegal callback provided, must be a function");h[e]=t},this.understands=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments[3];if(d.includes(e))throw new Error("[Lisa] Handler is already in use");if("string"==typeof t)t=new Function([],Reflect.ownKeys(r).map(function(e){return'Lisa.learns("'+e+'","'+r[e].replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function(e,t){return'"+arguments[0].formatted['+t+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function(e,t){return'"+arguments[0].caught['+t+']+"'})+'");'})+'return "'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\$\^(\d|[1-9]\d+)/g,function(e,t){return'"+arguments[0].formatted['+t+']+"'}).replace(/\$_(\d|[1-9]\d+)/g,function(e,t){return'"+arguments[0].caught['+t+']+"'})+'"');else{if("function"!=typeof t)throw new Error("[Lisa] Illegal handler's callback provided");if(r){var s=t;t=new Function(["requested"],"("+function(e){var t=!0,r=!1,n=void 0;try{for(var i,s=Reflect.ownKeys(e)[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var a=i.value;Lisa.learns(a,e[a].replace(/\$\^(\d|[1-9]\d+)/g,function(e,t){return requested.formatted[t]}).replace(/\$_(\d|[1-9]\d+)/g,function(e,t){return requested.caught[t]}))}}catch(e){r=!0,n=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw n}}}.toString()+")("+JSON.stringify(r)+");return ("+s.toString()+")(requested);")}}var a=n.makeHandlerRegex(e,!0);if(i){if(!Array.isArray(i))throw new Error("[Lisa] Illegal help text argument provided");if(i.length!==a[1].length)throw new Error('[Lisa] Insufficient help for parameters in handler "'+e+'"');var o=!0,l=!1,u=void 0;try{for(var c,p=i[Symbol.iterator]();!(o=(c=p.next()).done);o=!0){var g=c.value;if(!["string","function"].includes("undefined"==typeof g?"undefined":_typeof(g)))throw new Error('[Lisa] Illegal help text given for handler "'+e+'"')}}catch(e){l=!0,u=e}finally{try{!o&&p.return&&p.return()}finally{if(l)throw u}}}return f.push([a[0],a[1],a[2],t,i||null]),d.push(e),h.understood&&h.understood(new RegExp(a[0].toString().slice(1,-2)),a[1].slice(0),a[2].toString().slice(1,-2),t,i?i.slice(0):null),a[0]},this.displayMessage=function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t=t.toString();var s=document.createElement("div");s.setAttribute("class","message message-"+r),s.innerHTML="<strong>"+e+" : </strong>"+(i?t:n.format(t)),a.appendChild(s);var l=a.scrollHeight-a.scrollTop,c=setInterval(function(){return a.scrollTop++},Math.floor(2e3/l));setTimeout(function(){return clearInterval(c)},2e3),u&&o.push([Date.now(),e,t,r,!!i]),h.message&&h.message(Date.now(),e,t,r,!!i)},this.helpsAbout=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!d.includes(e))throw new Error('[Lisa] Unknown handler "'+e+'"');var r=f[d.indexOf(e)][3];if(!r)return!1;if(t)return r.slice(0);var n=0;return e.replace(/\{(.*?)\}/g,function(e){return"["+r[n++]+"]"})},this.registersCatcher=function(e,t){if("string"!=typeof e||!e||{}[e]||!/^[a-z_][a-z0-9_#\*\?\!\+\-\/\\]*$/.test(e))throw new Error("[Lisa] Illegal catcher's name provided");if("string"!=typeof t||!t)throw new Error("[Lisa] Invalid catcher's regex provided, must be a not-empty string");if(i.hasOwnProperty(e))throw new Error('[Lisa] Catcher "'+e+'" is already registered');i[e]=function(){return t}},this.hasRegistered=function(e){return i.hasOwnProperty(e)},this.thinksToRegisteredCatchers=function(){return Reflect.ownKeys(i)},this.thinksToCatcher=function(t){return i.hasOwnProperty(t)?e(t):void 0},this.learns=function(e,t){if("string"!=typeof e||!e.length||{}[e]||"$"===e)throw new Error("[Lisa] Illegal name provided for memory's cell");if(!["string","number","boolean"].includes("undefined"==typeof t?"undefined":_typeof(t)))throw new Error("[Lisa] Illegal value provided for memory's cell \""+e+'"');c.$.hasOwnProperty(e)&&delete c.$[e],c[e]=t,h.learnt&&h.learnt(e,t)},this.learnsList=function(e,t,n){if("string"!=typeof e||!e.length||{}[e]||"$"===e)throw new Error("[Lisa] Illegal name provided for memory's cell");if(n={bool:"boolean",int:"integer",float:"floating",str:"string"}[n]||n,!["boolean","integer","floating","string"].includes(n))throw new Error('[Lisa] Unknown type "'+n+'", must be "boolean", "integer", "floating" or "string"');if(!Array.isArray(t))throw new Error("[Lisa] Illegal list provided, must be an array");t=t.slice(0);for(var i=0;i<t.length;i++)if(!r(t[i],n))throw new Error("[Lisa] Value at index "+i+" is not a "+n);c[e]=t,c.$[e]=n,h.learnt&&h.learnt(e,t.slice(0))},this.learnsBoolList=function(e,t){return n.learnsList(e,t,"boolean")},this.learnsIntList=function(e,t){return n.learnsList(e,t,"integer")},this.learnsFloatList=function(e,t){return n.learnsList(e,t,"floating")},this.learnsStrList=function(e,t){return n.learnsList(e,t,"string")},this.thinksToList=function(e){return c.$.hasOwnProperty(e)?c[e].slice(0):void 0},this.thinksToListValue=function(e,t){return c.$.hasOwnProperty(e)&&c[e].length>t?c[e][t]:void 0},this.thinksToListLastValue=function(e){return c.$.hasOwnProperty(e)?c[e].slice(-1)[0]:void 0},this.thinksToListType=function(e){return c.$.hasOwnProperty(e)?c.$[e]:void 0},this.learnsListValue=function(e,t){if(!c.$.hasOwnProperty(e))throw new Error('[Lisa] Unknown list "'+e+'"');if(!r(t,c.$[e]))throw new Error('[Lisa] Provided value for list "'+e+'" is not an '+c.$[e]);c[e].push(t),h.learnt&&h.learnt(e,t,c[e].length-1)},this.sortsList=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!c.$.hasOwnProperty(e))throw new Error('[Lisa] List "'+e+'" was not found');var n=(t?c[e]:c[e].slice(0)).sort(["integer","floating"].includes(c.$[e])?function(e,t){return e-t}:null);return r||(n=n.reverse()),t&&h.learnt&&h.learnt(e,list.slice(0)),t?n.slice(0):n},this.shufflesList=function(e,t){if(!c.$.hasOwnProperty(e))throw new Error('[Lisa] List "'+e+'" was not found');for(var r=t?c[e]:c[e].slice(0),n=r.length,i=void 0,s=void 0;n;)s=Math.floor(Math.random()*n),n--,i=r[n],r[n]=r[s],r[s]=i;return t&&h.learnt&&h.learnt(e,r.slice(0)),t?r.slice(0):r},this.reversesList=function(e,t){if(!c.$.hasOwnProperty(e))throw new Error('[Lisa] List "'+e+'" was not found');var r=(t?c[e]:c[e].slice(0)).reverse();return t&&h.learnt&&h.learnt(e,r.slice(0)),t?r.slice(0):r},this.knows=function(e){return"$"!==e&&c.hasOwnProperty(e)},this.knowsValue=function(e){return Object.values(c).includes(e)},this.knowsValueInList=function(e,t){return c.$.hasOwnProperty(e)&&c[e].includes(t)},this.searchesValue=function(e,t){var r=!0,n=!1,i=void 0;try{for(var s,a=Reflect.ownKeys(c)[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var o=s.value;if(c[o]===e)return o;if(c.$[o]){if(!t)continue;if(c[o].includes(e))return o}}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return!1},this.isList=function(e){return c.$.hasOwnProperty(e)},this.thinksTo=function(e){return c.hasOwnProperty(e)&&"$"!==e?Array.isArray(c[e])?c[e].join(";"):c[e]:void 0},this.forgets=function(e){if(!c.hasOwnProperty(e)||"$"===e)throw new Error("[Lisa] Can't forget unexisting cell");var t=c[e];return delete c[e],delete c.$[e],h.forgot&&h.forgot(e,t),t},this.thinksToListLength=function(e){return c.$.hasOwnProperty(e)?c[e].length:void 0},this.says=function(e,t){return n.displayMessage("Lisa",e,"lisa",t)},this.hears=function(e,t){return n.displayMessage("You",e,"user",t)},this.does=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e;e=e.trim();var i=void 0,s=!0,a=!1,o=void 0;try{for(var c,p=f[Symbol.iterator]();!(s=(c=p.next()).done);s=!0){var g=c.value;if(g[2].test(e)){if(!(i=e.match(g[0]))){var m=n.thinksTo("REQUEST_SYNTAX_ERROR");return"string"!=typeof m&&(m="A part of your answer is not valid. Please check it."),t&&n.says(m),m}for(var y={request:e,requestWithSpaces:r,caught:i.slice(1),formatted:[],handlerRegex:g[2],handlerStrictRegex:g[0],catchers:g[1],callback:g[3],help:g[4],handler:d[f.indexOf(g)],display:!!t},v=0;v<g[1].length;v++)y.formatted.push(n.getStandard(i[v+1],g[1][v]));var w=g[3].call(n,y),L=!1;return"number"==typeof w?w=w.toString():w&&w instanceof HTMLElement?(w=w.innerHTML,L=!0):"string"!=typeof w&&w!==!1&&(w="Sorry, I encountered a problem. Please try again."),t&&w!==!1&&n.says(w,L),u&&w!==!1&&l.push([Date.now(),y.requestWithSpaces,y.handler,y.caught.slice(0),y.display]),h.did&&h.did(l.slice(-1)[0],JSON.parse(JSON.stringify(y)),w),w}}}catch(e){a=!0,o=e}finally{try{!s&&p.return&&p.return()}finally{if(a)throw o}}var b=n.thinksTo("MISUNDERSTOOD_ERROR");return"string"!=typeof b&&(b="I didn't understand your request."),t&&n.says(b),b},this.nowRemembersMessages=function(){return void(u=!0)},this.doesntRememberMessages=function(){return void(u=!1)},this.getMessage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("number"!=typeof e||Math.floor(e)!==e)throw new Error("[Lisa] Invalid ID given while getting message");if(e<0&&(e=-e),o.length<=e)throw new Error('[Lisa] There is no message with id "'+e+'"');return o.slice(0)},this.export=function(){var e=[],t=!0,r=!1,n=void 0;try{for(var a,h=f[Symbol.iterator]();!(t=(a=h.next()).done);t=!0){var p=a.value;e.push([p[0].toString(),p[1],p[2].toString(),p[3].toString(),p[4]])}}catch(e){r=!0,n=e}finally{try{!t&&h.return&&h.return()}finally{if(r)throw n}}var g={},m=!0,y=!1,v=void 0;try{for(var w,L=Reflect.ownKeys(i)[Symbol.iterator]();!(m=(w=L.next()).done);m=!0){var b=w.value;s.includes(b)||(g[b]=i[b]())}}catch(e){y=!0,v=e}finally{try{!m&&L.return&&L.return()}finally{if(y)throw v}}return JSON.stringify({memory:c,handled:d,handlers:e,rememberMessages:u,messages:o,requests:l,catchers:g})},this.learns("HOURS_NAME","hours"),this.learns("MINUTES_NAME","minutes"),this.learns("SECONDS_NAME","secondes"),this.learns("MONTHS","january,february,march,april,may,june,july,august,september,october,november,december"),this.__defineGetter__("dom",function(){return a}),this.__defineGetter__("memory",function(){return JSON.parse(JSON.stringify(c))}),this.__defineGetter__("messages",function(){return JSON.parse(JSON.stringify(o))}),this.__defineGetter__("history",function(){return JSON.parse(JSON.stringify(l))}),this.__defineGetter__("remembersMessages",function(){return u}),this.__defineSetter__("remembersMessages",function(e){return e?n.nowRemembersMessages():n.doesntRememberMessages()})};Lisa.dom.setAttribute("id","discuss"),document.body.appendChild(Lisa.dom);var input=document.createElement("input");input.setAttribute("id","input"),input.addEventListener("keydown",function(e){if(13===e.keyCode){if(!input.value.length)return;var t=input.value;input.value="",Lisa.hears(t),Lisa.does(t)}}),document.body.appendChild(input);var data=localStorage.getItem("lisa_state");if(data){var corrupted=function(){"object"===("undefined"==typeof console?"undefined":_typeof(console))&&"function"==typeof console.error&&console.error("Corrupted data found in localStorage"),("object"===("undefined"==typeof window?"undefined":_typeof(window))?window:"object"===("undefined"==typeof global?"undefined":_typeof(global))?global:"object"===_typeof(this)?this:{}).corrupted_local_lisa_state=data,localStorage.removeItem("lisa_state"),data=null};if(data.startsWith("L")?"object"===("undefined"==typeof LZString?"undefined":_typeof(LZString))&&"function"==typeof LZString.decompressFromUTF16||("object"===("undefined"==typeof console?"undefined":_typeof(console))&&"function"==typeof console.error?console.error("Found compressed data in local storage, but the LZString library was not found."):data=reverse(LZString.decompressFromUTF16(reverse(data.substr(1))))):data.startsWith("P")?data=reverse(data.substr(1)):corrupted(),data){try{data=JSON.parse(data)}catch(e){corrupted()}data&&loadState(data)}}Lisa.when("message",saveState),Lisa.when("did",saveState),Lisa.when("understood",saveState),Lisa.Script={comparators:{"=":"===","==":"===",is:"===","!":"!==","!=":"!==","!==":"!==","is not":"!==",isnt:"!=="},functions:{listLength:"Lisa.thinksToListLength",random:"Math.random",round:"Math.round",trunc:"Math.trunc",abs:"Math.abs",sin:"Math.sin",cos:"Math.cos",exp:"Math.exp",log:"Math.log",pow:"Math.pow",sqrt:"Math.sqrt",randInt:"Lisa.Script.libRandomInteger",int:"parseInt",float:"parseFloat"},compile:function(e,t,r){function n(e){throw new Error("[LIS:compile] At line "+g+" :\n"+m+"\n^\n"+e)}function i(e){return e.startsWith("$")?e.substr(1):e.startsWith("_")?"_a.caught["+e.substr(1)+"]":e.startsWith("^")?"_a.formatted["+e.substr(1)+"]":'Lisa.thinksTo("'+e+'")'}function s(){for(var e=0;e<f-h;e++)y.includes(f-e-1)?(c+=(t?"\n"+"  ".repeat(h+e+2):"")+"return false;"+(t?"\n"+"  ".repeat(h+e+1):"")+"});",y.splice(y.indexOf(f-e-1),1)):c+=(t?"\n"+"  ".repeat(h+e+1):"")+"}";f=h}var a=this,o=function e(t){return('"'+t+'"').replace(/"(.*?)"/g,function(t){return t.replace(/([a-z]+) *\(/gi,function(e,t){return a.functions.hasOwnProperty(t)?a.functions[t]+"(":void n('Unknown function "'+t+'"')}).replace(/([^a-z0-9\^_\$]|^)(\$?[a-z][a-z0-9_]*|_(?:\d|[1-9]\d+)|\^(?:\d|[1-9]\d+))( *\[ *(.*?) *\]|)(?! *[\(\.a-z])/gi,function(t,r,n,s,a){return r+(s?n.startsWith("$")?"~"===a?n.substr(1)+".slice(-1)[0]":n.substr(1)+"["+e(a)+"]":"~"===a?'Lisa.thinksToListLastValue("'+n+'")':'Lisa.thinksToListValue("'+n+'",'+e(a)+")":i(n))})}).slice(1,-1).replace(/"(.*?)"/g,function(e){return e.replace(/%([a-z][a-z0-9_]*|_(?:\d|[1-9]\d+)|\^(?:\d|[1-9]\d+))%/g,function(e,t){return'"+'+i(t)+'+"'})}).replace(/""\+/g,"").replace(/\+""/g,"")};if("string"!=typeof e)throw new Error("[LIS:compile] Invalid source code provided, must be a string");var l="",u=e.split(/\r\n|\r|\n/g),c="",d=[],f=0,h=void 0,p=void 0,g=0,m=void 0,y=[],v=!0,w=!1,L=void 0;try{for(var b,_=u[Symbol.iterator]();!(v=(b=_.next()).done);v=!0)m=b.value,g++,h=m.match(/^(  |\t)*/)[0].replace(/  /g,"\t").length,m=m.trim(),m&&(f&&(h>f?n("Wrong indentation, expecting "+f+" tab"+(f>1?"s":"")+" but "+h+" given."):h<f&&s()),!f&&h&&n("Wrong indentation, expecting no tab"),t&&(l="\n"+"  ".repeat(f+1)),(p=m.match(/^else +/))&&(c+=l+"else ",m=m.substr(p[0].length)),"else"===m?(c+=l+"else{",f++):m.startsWith("#")?r&&(c+=l+("/*"+m.substr(1)+"*/")):(p=m.match(/^(\$|)([a-z][a-z0-9_]*) *= *(.*)$/i))?p[1]?(c+=l+(p[2]+"="+o(p[3])+";"),d.includes(p[2])||d.push(p[2])):c+=l+('Lisa.learns("'+p[2]+'",'+o(p[3])+")"):(p=m.match(/^if( +NOT *|) +([a-z][a-z0-9_]*|_\d+|\^\d+)$/i))?(c+=l+("if("+(p[1]?"!":"")+o(p[2])+"){"),f++):(p=m.match(/^if( +NOT *|) +knows +([a-z][a-z0-9_]*|_\d+|\^\d+)$/i))?(c+=l+("if("+(p[1]?"!":"")+'Lisa.knows("'+p[2]+'")){'),f++):(p=m.match(/^if( +NOT *|) +(islist|is_list|list) +([a-z][a-z0-9_]*)$/i))?(c+=l+("if("+(p[1]?"!":"")+'Lisa.isList("'+p[3]+'")){'),f++):(p=m.match(/^if +([a-z][a-z0-9_]*|_\d+|\^\d+) *(<=|>=|<|>) *(\d+[.]?|\d*\.\d+)$/i))?(c+=l+('if(Lisa.thinksTo("'+p[1]+'")'+p[2]+p[3]+"){"),f++):(p=m.match(/^if +(.*?) *(=|==|\!|\!=|\!==|is not|isnt|is) *(.*?)$/i))?(c+=l+("if("+o(p[1])+this.comparators[p[2]]+o(p[3])+"){"),f++):(p=m.match(/^say +(.*)$/))?c+=l+("Lisa.says("+o(p[1])+");"):(p=m.match(/^(end|return|die|output) +(.*)$/i))?c+=l+"return "+o(p[2])+";":(p=m.match(/^(store|set|learn|rem|remember|mem|memorize|save)[s]? +(.*?) *=> *([a-z][a-z0-9_]*)$/i))?c+=l+('Lisa.learns("'+p[3]+'",'+o(p[2])+");"):(p=m.match(/^"(.*)" *=>$/))?(c+=l+('Lisa.understands("'+p[1]+'",function(){'+(l?l+"  ":"")+"var _a=arguments[0];"),y.push(f),f++):(p=m.match(/^(unstore|unset|unlearn|unremember|unmemorize|unsave|forget)[s]? +([a-z][a-z0-9_]*)$/i))?c+=l+('Lisa.forgets("'+p[2]+'");'):(p=m.match(/^(makelist|createlist|setlist) +(bool|boolean|int|integer|float|floating|str|string) +([a-z][a-z0-9_]*)$/i))?c+=l+('Lisa.learnsList("'+p[3]+'",[],"'+p[2]+'");'):(p=m.match(/^(pushlist|push|append|add) +(.*?) +in +([a-z][a-z0-9_]*)$/i))?c+=l+('Lisa.learnsListValue("'+p[3]+'",'+o(p[2])+");"):(p=m.match(/^(sorts?_?a?|sorts?_?asc|sorts?_?list|sorts?_?list_?asc) +([a-zA-Z][a-zA-Z0-9_]*)$/))?c+=l+('Lisa.sortsList("'+p[2]+'",true);'):(p=m.match(/^(sorts?|sorts?_?d?|sorts?_?desc|sorts?_?list_?d|sorts?_?list_?desc) +([a-z][a-z0-9_]*)$/i))?c+=l+('Lisa.sortsList("'+p[2]+'",true,false);'):(p=m.match(/^(shuffles?|shuffles?_?list|rand_?list|randomize_?list|randomize) +([a-z][a-z0-9_]*)$/i))?c+=l+('Lisa.shufflesList("'+p[2]+'",true);'):(p=m.match(/^(reverses?|reverses?_?list) +([a-z][a-z0-9_]*)$/i))?c+=l+('Lisa.reversesList("'+p[2]+",true);"):n("Syntax error"))}catch(e){w=!0,L=e}finally{try{!v&&_.return&&_.return()}finally{if(w)throw L}}return h=0,s(),"(function(){"+(d.length?"var "+d.join(",")+";":"")+c+(t?"\n":"")+"})();"},exec:function(e){new Function([],this.compile(e))()},download:function(e){var t=this,r=void 0;if("string"!=typeof e||!e)throw new Error("[LIS:download] Illegal URL provided, must be a not-empty string");if(e.startsWith("file://"))throw new Error('[LIS:download] Protocol "file:///" is forbidden: Lisa is not allowed to load local computer\'s resources');(r=e.match(/^presets?:\/\/\/?((?:[a-zA-Z_0-9][\/\\]?)+)(\.lis|)$/i))&&(e=location.href.split("/").slice(0,-1).join("/")+"/presets/"+r[1].split("\\").join("/")+".lis");var n=getXMLHttpRequest();n.open("GET",e,!0),n.addEventListener("readystatechange",function(e){if(4===n.readyState){if(200!==n.status)throw new Error("[LIS:download] Failed to download the LIS program (status code: "+n.status+")");t.exec(n.responseText)}}),n.send(null)},libRandomInteger:function(e,t){return"undefined"==typeof t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}};